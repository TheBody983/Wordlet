!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@onflow/interaction"),require("@onflow/protobuf"),require("@onflow/response"),require("@onflow/util-address"),require("@improbable-eng/grpc-web"),require("@improbable-eng/grpc-web-node-http-transport"),require("@onflow/config")):"function"==typeof define&&define.amd?define(["exports","@onflow/interaction","@onflow/protobuf","@onflow/response","@onflow/util-address","@improbable-eng/grpc-web","@improbable-eng/grpc-web-node-http-transport","@onflow/config"],t):t((e=e||self).send={},e.interaction,e.protobuf,e.response,e.utilAddress,e.grpcWeb,e.grpcWebNodeHttpTransport,e.config)}(this,function(e,t,r,n,o,s,a,i){var c=function(e,t,r){try{return Promise.resolve(new Promise(function(n,o){s.grpc.unary(t,{request:r,host:e,onEnd:function(e){var t=e.statusMessage;e.status===s.grpc.Code.OK?n(e.message):o(new Error(t))}})}))}catch(e){return Promise.reject(e)}};s.grpc.setDefaultTransport(a.NodeHttpTransport());var u=function(e){return Buffer.from(e,"hex")},g=function(e){return Buffer.from(e.padStart(16,0),"hex")};function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var d=function(e){return Buffer.from(e).toString("hex")},f=function(e){return Buffer.from(e).toString("hex")},p=function(e){return Buffer.from(e).toString("hex")},m=function(e){return Buffer.from(e).toString("hex")};e.send=function(e,s){void 0===s&&(s={});try{var a=function(a){return s.node=a,Promise.resolve(e).then(function(a){switch(e=a,!0){case t.isTransaction(e):return function(e,t){void 0===t&&(t={});try{return Promise.resolve(e).then(function(s){e=s;var a=new r.Transaction;a.setScript(Buffer.from(e.message.cadence,"utf8")),a.setGasLimit(e.message.computeLimit),a.setReferenceBlockId(e.message.refBlock?u(e.message.refBlock):null),a.setPayer(g(o.sansPrefix(e.accounts[e.payer].addr))),e.message.arguments.forEach(function(t){return a.addArguments(function(e){return Buffer.from(JSON.stringify(e),"utf8")}(e.arguments[t].asArgument))}),e.authorizations.map(function(t){return e.accounts[t].addr}).reduce(function(e,t){return e.find(function(e){return e===t})?e:[].concat(e,[t])},[]).forEach(function(e){return a.addAuthorizers(g(o.sansPrefix(e)))});var i=new r.Transaction.ProposalKey;i.setAddress(g(o.sansPrefix(e.accounts[e.proposer].addr))),i.setKeyId(e.accounts[e.proposer].keyId),i.setSequenceNumber(e.accounts[e.proposer].sequenceNum),a.setProposalKey(i);for(var l=0,d=Object.values(e.accounts);l<d.length;l++){var f=d[l];try{if(!f.role.payer&&null!=f.signature){var p=new r.Transaction.Signature;p.setAddress(g(o.sansPrefix(f.addr))),p.setKeyId(f.keyId),p.setSignature(u(f.signature)),a.addPayloadSignatures(p)}}catch(t){throw console.error("Trouble applying payload signature",{acct:f,ix:e}),t}}for(var m=0,v=Object.values(e.accounts);m<v.length;m++){var h=v[m];try{if(h.role.payer&&null!=h.signature){var I=new r.Transaction.Signature;I.setAddress(g(o.sansPrefix(h.addr))),I.setKeyId(h.keyId),I.setSignature(u(h.signature)),a.addEnvelopeSignatures(I)}}catch(t){throw console.error("Trouble applying envelope signature",{acct:h,ix:e}),t}}var S=new r.SendTransactionRequest;S.setTransaction(a);var P=Date.now();return Promise.resolve(c(t.node,r.AccessAPI.SendTransaction,S)).then(function(t){var r,o=Date.now(),s=n.response();return s.tag=e.tag,s.transactionId=(r=t.getId_asU8(),Buffer.from(r).toString("hex")),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("FLOW::TX",{detail:{txId:s.transactionId,delta:o-P}})),s})})}catch(e){return Promise.reject(e)}}(e,s);case t.isGetTransactionStatus(e):return function(e,t){void 0===t&&(t={});try{return Promise.resolve(e).then(function(o){e=o;var s=new r.GetTransactionRequest;return s.setId(Buffer.from(e.transactionId,"hex")),Promise.resolve(c(t.node,r.AccessAPI.GetTransactionResult,s)).then(function(t){var r=t.getEventsList(),o=n.response();return o.tag=e.tag,o.transaction={status:t.getStatus(),statusCode:t.getStatusCode(),errorMessage:t.getErrorMessage(),events:r.map(function(e){return{type:e.getType(),transactionId:(t=e.getTransactionId_asU8(),Buffer.from(t).toString("hex")),transactionIndex:e.getTransactionIndex(),eventIndex:e.getEventIndex(),payload:JSON.parse(Buffer.from(e.getPayload_asU8()).toString("utf8"))};var t})},o})})}catch(e){return Promise.reject(e)}}(e,s);case t.isScript(e):return function(e,t){void 0===t&&(t={});try{return Promise.resolve(e).then(function(o){e=o;var s=new r.ExecuteScriptAtLatestBlockRequest,a=Buffer.from(e.message.cadence,"utf8");return e.message.arguments.forEach(function(t){return s.addArguments(function(e){return Buffer.from(JSON.stringify(e),"utf8")}(e.arguments[t].asArgument))}),s.setScript(a),Promise.resolve(c(t.node,r.AccessAPI.ExecuteScriptAtLatestBlock,s)).then(function(t){var r=n.response();return r.tag=e.tag,r.encodedData=JSON.parse(Buffer.from(t.getValue_asU8()).toString("utf8")),r})})}catch(e){return Promise.reject(e)}}(e,s);case t.isGetAccount(e):return function(e,t){void 0===t&&(t={});try{return Promise.resolve(e).then(function(s){e=s;var a,i=new r.GetAccountRequest;return i.setAddress((a=o.sansPrefix(e.accountAddr),Buffer.from(a.padStart(16,0),"hex"))),Promise.resolve(c(t.node,r.AccessAPI.GetAccount,i)).then(function(t){var r=n.response();r.tag=e.tag;var s,a=t.getAccount(),i=(s=a.getContractsMap())?s.getEntryList().reduce(function(e,t){var r;return l({},e,((r={})[t[0]]=new TextDecoder("utf-8").decode(t[1]||new UInt8Array),r))},{}):{};return r.account={address:o.withPrefix(d(a.getAddress_asU8())),balance:a.getBalance(),code:new TextDecoder("utf-8").decode(a.getCode_asU8()||new UInt8Array),contracts:i,keys:a.getKeysList().map(function(e){return{index:e.getIndex(),publicKey:d(e.getPublicKey_asU8()),signAlgo:e.getSignAlgo(),hashAlgo:e.getHashAlgo(),weight:e.getWeight(),sequenceNumber:e.getSequenceNumber(),revoked:e.getRevoked()}})},r})})}catch(e){return Promise.reject(e)}}(e,s);case t.isGetEvents(e):return function(e,t){void 0===t&&(t={});try{return Promise.resolve(e).then(function(o){e=o;var s=new r.GetEventsForHeightRangeRequest;return s.setType(e.events.eventType),s.setStartHeight(Number(e.events.start)),s.setEndHeight(Number(e.events.end)),Promise.resolve(c(t.node,r.AccessAPI.GetEventsForHeightRange,s)).then(function(t){var r=n.response();r.tag=e.tag;var o=t.getResultsList();return r.events=o.reduce(function(e,t){var r=t.getBlockId(),n=t.getBlockHeight();return t.getEventsList().forEach(function(t){var o;e.push({blockId:r,blockHeight:n,type:t.getType(),transactionId:(o=t.getTransactionId_asU8(),Buffer.from(o).toString("hex")),transactionIndex:t.getTransactionIndex(),eventIndex:t.getEventIndex(),payload:JSON.parse(Buffer.from(t.getPayload_asU8()).toString("utf8"))})}),e},[]),r})})}catch(e){return Promise.reject(e)}}(e,s);case t.isGetLatestBlock(e):return function(e,t){void 0===t&&(t={});try{return Promise.resolve(e).then(function(o){e=o;var s=new r.GetLatestBlockRequest;return e.latestBlock&&e.latestBlock.isSealed&&(s.setIsSealed(e.latestBlock.isSealed),console.error("\n          %c@onflow/send Deprecation Notice\n          ========================\n\n          Operating upon data of the latestBlock field of the interaction object is deprecated and will no longer be recognized in future releases of @onflow/send.\n          Find out more here: https://github.com/onflow/flow-js-sdk/blob/master/packages/send/WARNINGS.md#0001-Deprecating-latestBlock-field\n\n          =======================\n        ".replace(/\n\s+/g,"\n").trim(),"font-weight:bold;font-family:monospace;")),e.block&&e.block.isSealed&&s.setIsSealed(e.block.isSealed),Promise.resolve(c(t.node,r.AccessAPI.GetLatestBlock,s)).then(function(t){var r=t.getBlock(),o=r.getCollectionGuaranteesList(),s=r.getBlockSealsList(),a=r.getSignaturesList(),i=n.response();return i.tag=e.tag,i.block={id:f(r.getId_asU8()),parentId:f(r.getParentId_asU8()),height:r.getHeight(),timestamp:r.getTimestamp(),collectionGuarantees:o.map(function(e){return{collectionId:f(e.getCollectionId_asU8()),signatures:e.getSignaturesList()}}),blockSeals:s.map(function(e){return{blockId:f(e.getBlockId_asU8()),executionReceiptId:f(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()}}),signatures:a},i})})}catch(e){return Promise.reject(e)}}(e,s);case t.isGetBlockById(e):return function(e,t){void 0===t&&(t={});try{return Promise.resolve(e).then(function(o){e=o;var s=new r.GetBlockByIDRequest;return s.setId(Buffer.from(e.block.id,"hex")),Promise.resolve(c(t.node,r.AccessAPI.GetBlockByID,s)).then(function(t){var r=t.getBlock(),o=r.getCollectionGuaranteesList(),s=r.getBlockSealsList(),a=r.getSignaturesList(),i=n.response();return i.tag=e.tag,i.block={id:p(r.getId_asU8()),parentId:p(r.getParentId_asU8()),height:r.getHeight(),timestamp:r.getTimestamp(),collectionGuarantees:o.map(function(e){return{collectionId:p(e.getCollectionId_asU8()),signatures:e.getSignaturesList()}}),blockSeals:s.map(function(e){return{blockId:p(e.getBlockId_asU8()),executionReceiptId:p(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()}}),signatures:a},i})})}catch(e){return Promise.reject(e)}}(e,s);case t.isGetBlockByHeight(e):return function(e,t){void 0===t&&(t={});try{return Promise.resolve(e).then(function(o){e=o;var s=new r.GetBlockByHeightRequest;return s.setHeight(e.block.height),Promise.resolve(c(t.node,r.AccessAPI.GetBlockByHeight,s)).then(function(t){var r=t.getBlock(),o=r.getCollectionGuaranteesList(),s=r.getBlockSealsList(),a=r.getSignaturesList(),i=n.response();return i.tag=e.tag,i.block={id:m(r.getId_asU8()),parentId:m(r.getParentId_asU8()),height:r.getHeight(),timestamp:r.getTimestamp(),collectionGuarantees:o.map(function(e){return{collectionId:m(e.getCollectionId_asU8()),signatures:e.getSignaturesList()}}),blockSeals:s.map(function(e){return{blockId:m(e.getBlockId_asU8()),executionReceiptId:m(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()}}),signatures:a},i})})}catch(e){return Promise.reject(e)}}(e,s);case t.isPing(e):return function(e,t){void 0===t&&(t={});try{return Promise.resolve(e).then(function(o){e=o;var s=new r.PingRequest;return Promise.resolve(c(t.node,r.AccessAPI.Ping,s)).then(function(t){var r=n.response();return r.tag=e.tag,r})})}catch(e){return Promise.reject(e)}}(e,s);default:return e}})},v=s.node;return Promise.resolve(v?a(v):Promise.resolve(i.config().get("accessNode.api")).then(a))}catch(e){return Promise.reject(e)}}});
//# sourceMappingURL=send.umd.js.map
