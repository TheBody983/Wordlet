import{Ok as n,isTransaction as r,pipe as e}from"@onflow/interaction";function t(){return(t=Object.assign||function(n){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])}return n}).apply(this,arguments)}var o="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function i(n,r,e){if(!n.s){if(e instanceof u){if(!e.s)return void(e.o=i.bind(null,n,r));1&r&&(r=e.s),e=e.v}if(e&&e.then)return void e.then(i.bind(null,n,r),i.bind(null,n,2));n.s=r,n.v=e;var t=n.o;t&&t(n)}}var u=function(){function n(){}return n.prototype.then=function(r,e){var t=new n,o=this.s;if(o){var u=1&o?r:e;if(u){try{i(t,1,u(this.v))}catch(n){i(t,2,n)}return t}return this}return this.o=function(n){try{var o=n.v;1&n.s?i(t,1,r?r(o):o):e?i(t,1,e(o)):i(t,2,o)}catch(n){i(t,2,n)}},t},n}();function c(n){return n instanceof u&&1&n.s}var a=function(n){return"function"==typeof n},f=function(n){return"number"==typeof n},l=function(n){return"string"==typeof n},s=function(n,r){if(!n){var e,t=new Error("INVARIANT "+r);throw t.stack=t.stack.split("\n").filter(function(n){return!/at invariant/.test(n)}).join("\n"),(e=console).error.apply(e,["\n\n---\n\n",t,"\n\n"].concat([].slice.call(arguments,2),["\n\n---\n\n"])),t}},p=function(n){return!(n.role.proposer&&!(l(n.addr)&&f(n.keyId)&&f(n.sequenceNum)&&a(n.signingFunction))||n.role.payer&&!(l(n.addr)&&f(n.keyId)&&a(n.signingFunction))||n.role.authorizer&&!(l(n.addr)&&f(n.keyId)&&a(n.signingFunction)))},d=function(n){return void 0===n&&(n=[]),n.filter(Boolean)[0]||null},v=function(n){return void 0===n&&(n=[]),n.find(function(n){return n.role.proposer})||{}},h=function(e){try{var t=function(){return n(e)};if(!r(e))return Promise.resolve(n(e));var f=function(n,r,e){if("function"==typeof n[o]){var t,a,f,l=n[o]();if(function n(e){try{for(;!(t=l.next()).done;)if((e=r(t.value))&&e.then){if(!c(e))return void e.then(n,f||(f=i.bind(null,a=new u,2)));e=e.v}a?i(a,1,e):a=e}catch(n){i(a||(a=new u),2,n)}}(),l.return){var s=function(n){try{t.done||l.return()}catch(n){}return n};if(a&&a.then)return a.then(s,function(n){throw s(n)});s()}return a}if(!("length"in n))throw new TypeError("Object is not iterable");for(var p=[],d=0;d<n.length;d++)p.push(n[d]);return function(n,r,e){var t,o,a=-1;return function e(f){try{for(;++a<n.length;)if((f=r(a))&&f.then){if(!c(f))return void f.then(e,o||(o=i.bind(null,t=new u,2)));f=f.v}t?i(t,1,f):t=f}catch(n){i(t||(t=new u),2,n)}}(),t}(p,function(n){return r(p[n])})}(Object.entries(e.accounts),function(n){var r=n[0],t=n[1];function o(){s(p(e.accounts[r]),"Account unable to fulfill role",e.accounts[r])}var i=function(){if(a(t.resolve))return Promise.resolve(t.resolve(t)).then(function(n){e.accounts[r]=n})}();return i&&i.then?i.then(o):o()});return Promise.resolve(f&&f.then?f.then(t):t())}catch(n){return Promise.reject(n)}},y=function(e){try{if(!r(e))return Promise.resolve(n(e));for(var o=function(){var n,r,o,c=u[i],a=c.addr+"|"+c.keyId;e.accounts[a]=null!=e.accounts[a]?(n=e.accounts[a],r=t({tempId:a},c),{kind:d([n.kind,r.kind]),tempId:d([n.tempId,r.tempId]),addr:d([n.addr,r.addr]),keyId:(o=[n.keyId,r.keyId],void 0===o&&(o=[]),"number"==typeof o.filter(f)[0]?o.filter(f)[0]:null),sequenceNum:"number"==typeof v([n,r]).sequenceNum?v([n,r]).sequenceNum:n.sequenceNum,signature:d([n.signature,r.signature]),signingFunction:d([n.signingFunction,r.signingFunction]),resolve:d([n.resolve,r.resolve]),role:{proposer:n.role.proposer||r.role.proposer,authorizer:n.role.authorizer||r.role.authorizer,payer:n.role.payer||r.role.payer,param:n.role.param||r.role.param}}):t({tempId:a},c),e.proposer===c.tempId&&(e.proposer=a),e.payer===c.tempId&&(e.payer=a),e.authorizations=e.authorizations.map(function(n){return n===c.tempId?a:n}),delete e.accounts[c.tempId]},i=0,u=Object.values(e.accounts);i<u.length;i++)o();for(var c=0,a=Object.values(e.accounts);c<a.length;c++){var l=a[c];s(p(l),"Account unable to fulfill roles",l)}return Promise.resolve(n(e))}catch(n){return Promise.reject(n)}},m=e([h,y]);export{y as dedupeResolvedAccounts,h as enforceResolvedAccounts,m as resolveAccounts};
//# sourceMappingURL=sdk-resolve-accounts.module.js.map
