var n=require("@onflow/interaction");function r(){return(r=Object.assign||function(n){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])}return n}).apply(this,arguments)}var e="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function t(n,r,e){if(!n.s){if(e instanceof o){if(!e.s)return void(e.o=t.bind(null,n,r));1&r&&(r=e.s),e=e.v}if(e&&e.then)return void e.then(t.bind(null,n,r),t.bind(null,n,2));n.s=r,n.v=e;var i=n.o;i&&i(n)}}var o=function(){function n(){}return n.prototype.then=function(r,e){var o=new n,i=this.s;if(i){var u=1&i?r:e;if(u){try{t(o,1,u(this.v))}catch(n){t(o,2,n)}return o}return this}return this.o=function(n){try{var i=n.v;1&n.s?t(o,1,r?r(i):i):e?t(o,1,e(i)):t(o,2,i)}catch(n){t(o,2,n)}},o},n}();function i(n){return n instanceof o&&1&n.s}var u=function(n){return"function"==typeof n},c=function(n){return"number"==typeof n},a=function(n){return"string"==typeof n},s=function(n,r){if(!n){var e,t=new Error("INVARIANT "+r);throw t.stack=t.stack.split("\n").filter(function(n){return!/at invariant/.test(n)}).join("\n"),(e=console).error.apply(e,["\n\n---\n\n",t,"\n\n"].concat([].slice.call(arguments,2),["\n\n---\n\n"])),t}},l=function(n){return!(n.role.proposer&&!(a(n.addr)&&c(n.keyId)&&c(n.sequenceNum)&&u(n.signingFunction))||n.role.payer&&!(a(n.addr)&&c(n.keyId)&&u(n.signingFunction))||n.role.authorizer&&!(a(n.addr)&&c(n.keyId)&&u(n.signingFunction)))},f=function(n){return void 0===n&&(n=[]),n.filter(Boolean)[0]||null},p=function(n){return void 0===n&&(n=[]),n.find(function(n){return n.role.proposer})||{}},d=function(r){try{var c=function(){return n.Ok(r)};if(!n.isTransaction(r))return Promise.resolve(n.Ok(r));var a=function(n,r,u){if("function"==typeof n[e]){var c,a,s,l=n[e]();if(function n(e){try{for(;!(c=l.next()).done;)if((e=r(c.value))&&e.then){if(!i(e))return void e.then(n,s||(s=t.bind(null,a=new o,2)));e=e.v}a?t(a,1,e):a=e}catch(n){t(a||(a=new o),2,n)}}(),l.return){var f=function(n){try{c.done||l.return()}catch(n){}return n};if(a&&a.then)return a.then(f,function(n){throw f(n)});f()}return a}if(!("length"in n))throw new TypeError("Object is not iterable");for(var p=[],d=0;d<n.length;d++)p.push(n[d]);return function(n,r,e){var u,c,a=-1;return function e(s){try{for(;++a<n.length;)if((s=r(a))&&s.then){if(!i(s))return void s.then(e,c||(c=t.bind(null,u=new o,2)));s=s.v}u?t(u,1,s):u=s}catch(n){t(u||(u=new o),2,n)}}(),u}(p,function(n){return r(p[n])})}(Object.entries(r.accounts),function(n){var e=n[0],t=n[1];function o(){s(l(r.accounts[e]),"Account unable to fulfill role",r.accounts[e])}var i=function(){if(u(t.resolve))return Promise.resolve(t.resolve(t)).then(function(n){r.accounts[e]=n})}();return i&&i.then?i.then(o):o()});return Promise.resolve(a&&a.then?a.then(c):c())}catch(n){return Promise.reject(n)}},v=function(e){try{if(!n.isTransaction(e))return Promise.resolve(n.Ok(e));for(var t=function(){var n,t,u,a=i[o],s=a.addr+"|"+a.keyId;e.accounts[s]=null!=e.accounts[s]?(n=e.accounts[s],t=r({tempId:s},a),{kind:f([n.kind,t.kind]),tempId:f([n.tempId,t.tempId]),addr:f([n.addr,t.addr]),keyId:(u=[n.keyId,t.keyId],void 0===u&&(u=[]),"number"==typeof u.filter(c)[0]?u.filter(c)[0]:null),sequenceNum:"number"==typeof p([n,t]).sequenceNum?p([n,t]).sequenceNum:n.sequenceNum,signature:f([n.signature,t.signature]),signingFunction:f([n.signingFunction,t.signingFunction]),resolve:f([n.resolve,t.resolve]),role:{proposer:n.role.proposer||t.role.proposer,authorizer:n.role.authorizer||t.role.authorizer,payer:n.role.payer||t.role.payer,param:n.role.param||t.role.param}}):r({tempId:s},a),e.proposer===a.tempId&&(e.proposer=s),e.payer===a.tempId&&(e.payer=s),e.authorizations=e.authorizations.map(function(n){return n===a.tempId?s:n}),delete e.accounts[a.tempId]},o=0,i=Object.values(e.accounts);o<i.length;o++)t();for(var u=0,a=Object.values(e.accounts);u<a.length;u++){var d=a[u];s(l(d),"Account unable to fulfill roles",d)}return Promise.resolve(n.Ok(e))}catch(n){return Promise.reject(n)}},h=n.pipe([d,v]);exports.dedupeResolvedAccounts=v,exports.enforceResolvedAccounts=d,exports.resolveAccounts=h;
//# sourceMappingURL=sdk-resolve-accounts.js.map
