!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@onflow/config"),require("@onflow/interaction"),require("@onflow/util-invariant"),require("@onflow/sdk-latest-block"),require("@onflow/sdk-account"),require("@onflow/util-address"),require("@onflow/rlp"),require("@onflow/sdk-resolve"),require("@onflow/util-actor"),require("@onflow/sdk-send"),require("@onflow/sdk-decode"),require("@onflow/sdk-build-transaction-status"),require("@onflow/sdk-build-get-events"),require("@onflow/util-uid"),require("@onflow/util-template"),require("@onflow/sdk-build-transaction"),require("@onflow/sdk-build-script"),require("@onflow/sdk-build-ping"),require("@onflow/sdk-build-get-account"),require("@onflow/sdk-build-get-latest-block"),require("@onflow/sdk-build-get-block-by-id"),require("@onflow/sdk-build-get-block-by-height"),require("@onflow/sdk-build-authorizations"),require("@onflow/sdk-build-arguments"),require("@onflow/sdk-build-proposer"),require("@onflow/sdk-build-payer"),require("@onflow/sdk-build-limit"),require("@onflow/sdk-build-ref"),require("@onflow/sdk-build-params")):"function"==typeof define&&define.amd?define(["exports","@onflow/config","@onflow/interaction","@onflow/util-invariant","@onflow/sdk-latest-block","@onflow/sdk-account","@onflow/util-address","@onflow/rlp","@onflow/sdk-resolve","@onflow/util-actor","@onflow/sdk-send","@onflow/sdk-decode","@onflow/sdk-build-transaction-status","@onflow/sdk-build-get-events","@onflow/util-uid","@onflow/util-template","@onflow/sdk-build-transaction","@onflow/sdk-build-script","@onflow/sdk-build-ping","@onflow/sdk-build-get-account","@onflow/sdk-build-get-latest-block","@onflow/sdk-build-get-block-by-id","@onflow/sdk-build-get-block-by-height","@onflow/sdk-build-authorizations","@onflow/sdk-build-arguments","@onflow/sdk-build-proposer","@onflow/sdk-build-payer","@onflow/sdk-build-limit","@onflow/sdk-build-ref","@onflow/sdk-build-params"],n):n((e=e||self).fcl={},e.config,e.interaction,e.utilInvariant,e.sdkLatestBlock,e.sdkAccount,e.utilAddress,e.rlp,e.sdkResolve,e.utilActor,e.sdkSend,e.sdkDecode,e.sdkBuildTransactionStatus,e.sdkBuildGetEvents,e.utilUid,e.utilTemplate,e.sdkBuildTransaction,e.sdkBuildScript,e.sdkBuildPing,e.sdkBuildGetAccount,e.sdkBuildGetLatestBlock,e.sdkBuildGetBlockById,e.sdkBuildGetBlockByHeight,e.sdkBuildAuthorizations,e.sdkBuildArguments,e.sdkBuildProposer,e.sdkBuildPayer,e.sdkBuildLimit,e.sdkBuildRef,e.sdkBuildParams)}(this,function(e,n,r,t,o,i,u,a,s,c,f,d,l,p,m,h,v,y,g,b,P,k,w,I,E,S,j,A,O,x){n.config().put("accessNode.api","http://localhost:8080").put("challenge.handshake","http://localhost:8700/authenticate");var R=function(e){return"function"==typeof e},B=function(e){return"string"==typeof e},T=function(e){return"function"==typeof e},C="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function N(e,n,r){if(!e.s){if(r instanceof L){if(!r.s)return void(r.o=N.bind(null,e,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(N.bind(null,e,n),N.bind(null,e,2));e.s=n,e.v=r;var t=e.o;t&&t(e)}}var L=function(){function e(){}return e.prototype.then=function(n,r){var t=new e,o=this.s;if(o){var i=1&o?n:r;if(i){try{N(t,1,i(this.v))}catch(e){N(t,2,e)}return t}return this}return this.o=function(e){try{var o=e.v;1&e.s?N(t,1,n?n(o):o):r?N(t,1,r(o)):N(t,2,o)}catch(e){N(t,2,e)}},t},e}();function z(e){return e instanceof L&&1&e.s}var U=function e(n,r,o,i){void 0===i&&(i=3);try{var u=function(){o&&(n.authorizations=n.authorizations.map(function(e){return e===o.tempId?a:e}).reduce(function(e,n){return Array.isArray(n)?[].concat(e,n):[].concat(e,[n])},[]))};t.invariant(i,"Account Resolve Recursion Limit Exceeded",{ix:n,accounts:r});var a=[],s=function(e,n,r){if("function"==typeof e[C]){var t,o,i,u=e[C]();if(function e(r){try{for(;!(t=u.next()).done;)if((r=n(t.value))&&r.then){if(!z(r))return void r.then(e,i||(i=N.bind(null,o=new L,2)));r=r.v}o?N(o,1,r):o=r}catch(e){N(o||(o=new L),2,e)}}(),u.return){var a=function(e){try{t.done||u.return()}catch(e){}return e};if(o&&o.then)return o.then(a,function(e){throw a(e)});a()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var s=[],c=0;c<e.length;c++)s.push(e[c]);return function(e,n,r){var t,o,i=-1;return function r(u){try{for(;++i<e.length;)if((u=n(i))&&u.then){if(!z(u))return void u.then(r,o||(o=N.bind(null,t=new L,2)));u=u.v}t?N(t,1,u):t=u}catch(e){N(t||(t=new L),2,e)}}(),t}(s,function(e){return n(s[e])})}(r,function(r){function t(){function t(){u.tempId!=r.tempId&&delete n.accounts[u.tempId]}var s=function(){if(Array.isArray(r))return Promise.resolve(e(n,r,u,i-1)).then(function(){});n.accounts[r.tempId]=n.accounts[r.tempId]||r,n.accounts[r.tempId].role.proposer=n.accounts[r.tempId].role.proposer||r.role.proposer,n.accounts[r.tempId].role.payer=n.accounts[r.tempId].role.payer||r.role.payer,n.accounts[r.tempId].role.authorizer=n.accounts[r.tempId].role.authorizer||r.role.authorizer,n.accounts[r.tempId].role.proposer&&n.proposer===u.tempId&&(n.proposer=r.tempId),n.accounts[r.tempId].role.payer&&n.payer===u.tempId&&(n.payer=r.tempId),n.accounts[r.tempId].role.authorizer&&(o?a=[].concat(a,[r.tempId]):n.authorizations=n.authorizations.map(function(e){return e===u.tempId?r.tempId:e}))}();return s&&s.then?s.then(t):t()}var u=o||r,s=function(){if(_(r.resolve))return Promise.resolve(r.resolve(r,function(e,n){try{return{f_type:"PreSignable",f_vsn:"1.0.0",roles:e.role,cadence:n.message.cadence,args:n.message.arguments.map(function(e){return n.arguments[e].asArgument}),data:{},interaction:n}}catch(e){throw console.error("buildPreSignable",e),e}}(r,n))).then(function(e){r=e})}();return s&&s.then?s.then(t):t()});return Promise.resolve(s&&s.then?s.then(u):u())}catch(e){return Promise.reject(e)}},_=function(e){return"function"==typeof e};function q(){return(q=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e}).apply(this,arguments)}function D(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function F(e,n){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return D(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?D(e,void 0):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var t=0;return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}var M=function(e,n){return Buffer.from(e.padStart(2*n,0),"hex")},H=function(e){return M(e,8)},G=function(e){return Buffer.from(JSON.stringify(e),"utf8")},J=function(e){return a.encode(e).toString("hex")},K=function(e){return Z(e),[(r=e.script,Buffer.from(r,"utf8")),e.arguments.map(G),(n=e.refBlock,M(n,32)),e.gasLimit,H(e.proposalKey.address),e.proposalKey.keyId,e.proposalKey.sequenceNum,H(e.payer),e.authorizers.map(H)];var n,r},V=function(e){var n=Y(e);return e.payloadSigs.map(function(e){return{signerIndex:n.get(e.address),keyId:e.keyId,sig:e.sig}}).sort(function(e,n){return e.signerIndex>n.signerIndex?1:e.signerIndex<n.signerIndex?-1:e.keyId>n.keyId?1:e.keyId<n.keyId?-1:void 0}).map(function(e){return[e.signerIndex,e.keyId,(n=e.sig,Buffer.from(n,"hex"))];var n})},Y=function(e){var n=new Map,r=0,t=function(e){n.has(e)||(n.set(e,r),r++)};return t(e.proposalKey.address),t(e.payer),e.authorizers.forEach(t),n},Z=function(e){ee.forEach(function(n){return oe(e,n)}),ne.forEach(function(n){return oe(e.proposalKey,n,"proposalKey")})},X=function(e){return"number"==typeof e},W=function(e){return"string"==typeof e},$=function(e){return null!==e&&"object"==typeof e},Q=function(e){return $(e)&&e instanceof Array},ee=[{name:"script",check:W},{name:"arguments",check:Q},{name:"refBlock",check:W,defaultVal:"0"},{name:"gasLimit",check:X},{name:"proposalKey",check:$},{name:"payer",check:W},{name:"authorizers",check:Q}],ne=[{name:"address",check:W},{name:"keyId",check:X},{name:"sequenceNum",check:X}],re=[{name:"payloadSigs",check:Q}],te=[{name:"address",check:W},{name:"keyId",check:X},{name:"sig",check:W}],oe=function(e,n,r,t){var o=n.name,i=n.check,u=n.defaultVal;if(null==e[o]&&null!=u&&(e[o]=u),null==e[o])throw ue(o,r,t);if(!i(e[o]))throw ae(o,r,t)},ie=function(e,n,r){return n?null==r?n+"."+e:n+"."+r+"."+e:e},ue=function(e,n,r){return new Error("Missing field "+ie(e,n,r))},ae=function(e,n,r){return new Error("Invalid field "+ie(e,n,r))};function se(e,n){return function(r){try{var t=e.accounts[r];return null!=t.signature?Promise.resolve():Promise.resolve(t.signingFunction(function(e,n,r){try{return{f_type:"Signable",f_vsn:"1.0.0",message:n,addr:u.sansPrefix(e.addr),keyId:e.keyId,roles:e.role,cadence:r.message.cadence,args:r.message.arguments.map(function(e){return r.arguments[e].asArgument}),data:{},interaction:r}}catch(e){throw console.error("buildSignable",e),e}}(t,n,e))).then(function(n){e.accounts[r].signature=n.signature})}catch(e){return Promise.reject(e)}}}function ce(e){return{script:e.message.cadence,refBlock:e.message.refBlock||null,gasLimit:e.message.computeLimit,arguments:e.message.arguments.map(function(n){return e.arguments[n].asArgument}),proposalKey:{address:u.sansPrefix(e.accounts[e.proposer].addr),keyId:e.accounts[e.proposer].keyId,sequenceNum:e.accounts[e.proposer].sequenceNum},payer:u.sansPrefix(e.accounts[e.payer].addr),authorizers:e.authorizations.map(function(n){return u.sansPrefix(e.accounts[n].addr)}).reduce(function(e,n){return e.find(function(e){return e===n})?e:[].concat(e,[n])},[])}}var fe=r.pipe([function(e){try{var o=function(){if(r.isTransaction(e)||r.isScript(e)){var o=function(){return t.invariant(B(i),"Cadence needs to be a string at this point."),Promise.resolve(n.config().where(/^0x/).then(function(e){return Object.entries(e).reduce(function(e,n){return e.replace(n[0],n[1])},i)})).then(function(n){e.message.cadence=n})},i=r.get(e,"ix.cadence");t.invariant(R(i)||B(i),"Cadence needs to be a function or a string.");var u=function(){if(R(i))return Promise.resolve(i({})).then(function(e){i=e})}();return u&&u.then?u.then(o):o()}}();return Promise.resolve(o&&o.then?o.then(function(){return e}):e)}catch(e){return Promise.reject(e)}},function(e){try{if(r.isTransaction(e)||r.isScript(e))for(var n=0,o=Object.entries(e.arguments);n<o.length;n++){var i=o[n];e.arguments[i[0]].asArgument=(t.invariant(null!=typeof(u=i[1]).xform,"No type specified for argument: "+u.value),T(u.xform)?u.xform(u.value):T(u.xform.asArgument)?u.xform.asArgument(u.value):void t.invariant(!1,"Invalid Argument",u))}return Promise.resolve(e)}catch(e){return Promise.reject(e)}var u},function(e){try{var n=function(){if(r.isTransaction(e))return function(n,r){try{var t=Promise.resolve(U(e,Object.values(e.accounts))).then(function(){return Promise.resolve(U(e,Object.values(e.accounts))).then(function(){})})}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}(0,function(e){throw console.error("=== SAD PANDA ===\n\n",e,"\n\n=== SAD PANDA ==="),e})}();return Promise.resolve(n&&n.then?n.then(function(n){return e}):e)}catch(e){return Promise.reject(e)}},function(e){try{var n=function(){if(r.isTransaction(e)&&null==e.message.refBlock)return Promise.resolve(o.latestBlock()).then(function(n){e.message.refBlock=n.id})}();return Promise.resolve(n&&n.then?n.then(function(){return e}):e)}catch(e){return Promise.reject(e)}},function(e){try{var n=function(){if(r.isTransaction(e)){var n=Object.values(e.accounts).find(function(e){return e.role.proposer});t.invariant(n,"Transactions require a proposer");var o=function(){if(null==n.sequenceNum)return Promise.resolve(i.account(n.addr).then(function(e){return e.keys}).then(function(e){return e.find(function(e){return e.index===n.keyId})}).then(function(e){return e.sequenceNumber})).then(function(r){e.accounts[n.tempId].sequenceNum=r})}();if(o&&o.then)return o.then(function(){})}}();return Promise.resolve(n&&n.then?n.then(function(){return e}):e)}catch(e){return Promise.reject(e)}},function(e){try{var n=function(){if(r.isTransaction(e))return function(n,r){try{var t=(i=function(e){var n=new Set(e.authorizations);return n.add(e.proposer),n.delete(e.payer),Array.from(n)}(e),o=ce(e),u=J(K(o)),Promise.resolve(Promise.all(i.map(se(e,u)))).then(function(){var n=function(e){var n=new Set([e.payer]);return Array.from(n)}(e),r=function(e){return J(function(e){return function(e){re.forEach(function(n){return oe(e,n)}),e.payloadSigs.forEach(function(e,n){te.forEach(function(r){return oe(e,r,"payloadSigs",n)})})}(e),[K(e),V(e)]}(e))}(q({},ce(e),{payloadSigs:i.map(function(n){return{address:e.accounts[n].addr,keyId:e.accounts[n].keyId,sig:e.accounts[n].signature}})}));return Promise.resolve(Promise.all(n.map(se(e,r)))).then(function(){})}))}catch(e){return r(e)}var o,i,u;return t&&t.then?t.then(void 0,r):t}(0,function(n){throw console.error("Signatures",n,{ix:e}),n})}();return Promise.resolve(n&&n.then?n.then(function(n){return e}):e)}catch(e){return Promise.reject(e)}},function(e){try{for(var n=0,r=Object.keys(e.accounts);n<r.length;n++){var t=r[n];e.accounts[t].addr=u.sansPrefix(e.accounts[t].addr)}return Promise.resolve(e)}catch(e){return Promise.reject(e)}}]);n.config().put("sdk.resolve",fe);var de,le,pe=function(e){try{return Promise.resolve(f.send([l.getTransactionStatus(e)]).then(d.decode))}catch(e){return Promise.reject(e)}},me=function(e){return e.status>=4},he=function(e){return e.status>=3},ve=function(e){return e.status>=2},ye=((de={})[c.INIT]=function(e){try{return Promise.resolve(pe(e.self())).then(function(n){me(n)||setTimeout(function(){return e.sendSelf("POLL")},2500),e.merge(n)})}catch(e){return Promise.reject(e)}},de[c.SUBSCRIBE]=function(e,n){e.subscribe(n.from),e.send(n.from,c.UPDATED,e.all())},de[c.UNSUBSCRIBE]=function(e,n){e.unsubscribe(n.from)},de[c.SNAPSHOT]=function(e,n){try{return n.reply(e.all()),Promise.resolve()}catch(e){return Promise.reject(e)}},de.POLL=function(e){try{return Promise.resolve(pe(e.self())).then(function(n){var r,t;me(n)||setTimeout(function(){return e.sendSelf("POLL")},2500),r=e.all(),t=n,JSON.stringify(r)!==JSON.stringify(t)&&e.broadcast(c.UPDATED,n),e.merge(n)})}catch(e){return Promise.reject(e)}},de),ge=function(e){if("object"==typeof e&&(e=e.transactionId),null==e)throw new Error("transactionId required");return e},be=function(e){return c.spawn(ye,ge(e))};function Pe(e){function n(n){return c.subscriber(ge(e),be,n)}function r(e){return function(r){void 0===r&&(r={});var t=r.suppress||!1;return new Promise(function(r,o){var i=n(function(n){n.statusCode&&!t?(o(n.errorMessage),i()):e(n)&&(r(n),i())})})}}return{snapshot:function(){return c.snapshoter(e,be)},subscribe:n,onceFinalized:r(ve),onceExecuted:r(he),onceSealed:r(me)}}Pe.isUnknown=function(e){return e.status>=0},Pe.isPending=function(e){return e.status>=1},Pe.isFinalized=ve,Pe.isExecuted=he,Pe.isSealed=me,Pe.isExpired=function(e){return 5===e.status};var ke=function(e){try{var r=setTimeout;return Promise.resolve(n.config().get("fcl.eventPollRate",1e4)).then(function(n){return r(function(){return e.sendSelf("TICK")},n)})}catch(e){return Promise.reject(e)}},we=((le={}).TICK=function(e){try{if(!e.hasSubs())return Promise.resolve();var n=e.get("hwm"),r=function(){if(null==n){var r=e.put;return Promise.resolve(o.latestBlock()).then(function(n){r.call(e,"hwm",n);var t=e.put;return Promise.resolve(ke(e)).then(function(n){t.call(e,"tick",n)})})}return Promise.resolve(o.latestBlock()).then(function(r){return e.put("hwm",r),Promise.resolve(f.send([getEvents(e.self(),n.height,r.height-1)]).then(d.decode)).then(function(n){for(var r,t=F(n);!(r=t()).done;)e.broadcast("UPDATED",r.value.data);var o=e.put;return Promise.resolve(ke(e)).then(function(n){o.call(e,"tick",n)})})})}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},le[c.SUBSCRIBE]=function(e,n){try{var r=function(){e.subscribe(n.from)},t=function(){if(!e.hasSubs()){var n=e.put;return Promise.resolve(ke(e)).then(function(r){n.call(e,"tick",r)})}}();return Promise.resolve(t&&t.then?t.then(r):r())}catch(e){return Promise.reject(e)}},le[c.UNSUBSCRIBE]=function(e,n){e.unsubscribe(n.from),e.hasSubs()||(clearTimeout(e.get("tick")),e.delete("tick"),e.delete("hwm"))},le),Ie=function(e){return c.spawn(we,e)},Ee={f_type:"Service",f_vsn:"1.0.0"},Se={f_type:"Identity",f_vsn:"1.0.0"},je={f_type:"USER",f_vsn:"1.0.0"},Ae={f_type:"PollingResponse",f_vsn:"1.0.0"},Oe={f_type:"CompositeSignature",f_vsn:"1.0.0"};function xe(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return q({old:e},Ee,{type:"frame",endpoint:e.endpoint,params:e.params||{},data:e.data||{}})}}function Re(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return q({},Ee,{type:"back-channel-rpc",endpoint:e.endpoint,method:e.method,params:e.params||{},data:e.data||{}})}}var Be={"back-channel-rpc":Re,"pre-authz":function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return q({},Ee,{type:e.type,uid:e.id,endpoint:e.endpoint,method:e.method,identity:q({},Se,{address:u.withPrefix(e.addr),keyId:e.keyId}),params:e.params,data:e.data})}},authz:function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return q({},Ee,{type:e.type,uid:e.id,endpoint:e.endpoint,method:e.method,identity:q({},Se,{address:u.withPrefix(e.addr),keyId:e.keyId}),params:e.params,data:e.data})}},authn:function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return q({},Ee,{type:e.type,uid:e.id,endpoint:e.authn,id:e.pid,provider:{address:u.withPrefix(e.addr),name:e.name,icon:e.icon}})}},frame:xe};function Te(e){return a.encode([e.provider.address||e.provider.name||"UNSPECIFIED",e.id]).toString("hex")}function Ce(e,n){return void 0===e&&(e=[]),e.find(function(e){return e.type===n})}function Ne(e){var n=new URL(e.endpoint);if(n.searchParams.append("l6n",window.location.origin),null!=e.params)for(var r=0,t=Object.entries(e.params||{});r<t.length;r++){var o=t[r];n.searchParams.append(o[0],o[1])}return n}function Le(e,n){void 0===n&&(n={});var r=n.method||"POST",t="GET"===r?void 0:JSON.stringify(n.data||e.data||{});return fetch(Ne(e),{method:r,headers:q({},e.headers||{},n.headers||{},{"Content-Type":"application/json"}),body:t}).then(function(e){return e.json()})}function ze(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return q({},Ae,{status:e.status,reason:e.reason,data:e.compositeSignature||e.data||{},updates:Re(e.authorizationUpdates),local:xe((e.local||[])[0])})}}function Ue(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return q({},Oe,{addr:u.sansPrefix(e.addr||e.address),signature:e.signature||e.sig,keyId:e.keyId})}}var _e="FCL_IFRAME",qe=function(){},De=new Set(["monetizationstart","monetizationpending","monetizationprogress","monetizationstop"]);function Fe(e,n){if(void 0===n&&(n={}),console.log("FRAME",{service:e,opts:n}),null==e)return{send:qe,close:qe};var r=n.onClose||qe,o=n.onMessage||qe,i=n.onReady||qe;window.addEventListener("message",c);var u=function(e){t.invariant(!document.getElementById(_e),"Attempt at triggering multiple Frames",{src:e});var n=document.createElement("iframe");return n.src=e,n.id=_e,n.allow="usb *",n.frameBorder="0",n.style.cssText="\n  position:fixed;\n  top: 0px;\n  right: 0px;\n  bottom: 0px;\n  left: 0px;\n  height: 100vh;\n  width: 100vw;\n  display:block;\n  background:rgba(0,0,0,0.25);\n  z-index: 2147483647;\n  box-sizing: border-box;\n",document.body.append(n),[n,function(){document.getElementById(_e)&&document.getElementById(_e).remove()}]}(Ne(e)),a=u[0],s=u[1];return{send:d,close:f};function c(e){try{if("object"!=typeof e.data)return;if(De.has(e.data.type))return;"FCL:FRAME:CLOSE"===e.data.type&&f(),"FCL:FRAME:READY"===e.data.type&&i(e,{send:d,close:f}),o(e,{send:d,close:f}),"FCL::AUTHZ_READY"===e.data.type&&i(e,{send:d,close:f}),"FCL::CHALLENGE::CANCEL"===e.data.type&&f(),"FCL::CANCEL"===e.data.type&&f()}catch(e){console.error("Frame Callback Error",e),f()}}function f(){try{window.removeEventListener("message",c),s(),r()}catch(e){console.error("Frame Close Error",e)}}function d(e){try{console.log("SEND",e),a.contentWindow.postMessage(JSON.parse(JSON.stringify(e||{})),"*")}catch(n){console.error("Frame Send Error",e,n)}}}var Me,He={"HTTP/GET":"GET","HTTP/POST":"POST"},Ge=function(e){return t.invariant(He[e.method],"Invalid Service Method for type back-channel-rpc",{service:e}),He[e.method]},Je=function(e,n){try{return n.data=e.data,Promise.resolve(Le(e,{data:n}).then(ze)).then(function(n){if("APPROVED"===n.status)return n.data;if("DECLINED"===n.status)throw new Error("Declined: "+(n.reason||"No reason supplied."));if("PENDING"===n.status){var r=!0,o=Fe(n.local,{onClose:function(){r=!1}}).close;return function e(n,r){void 0===r&&(r=function(){return!0});try{if(t.invariant(n,"Missing Polling Service",{service:n}),!r())throw new Error("Externally Halted");return Promise.resolve(Le(n,{method:Ge(n)}).then(ze)).then(function(n){switch(n.status){case"APPROVED":return n.data;case"DECLINED":throw new Error("Declined: "+(n.reason||"No reason supplied."));default:return Promise.resolve(new Promise(function(e){return setTimeout(e,500)})).then(function(){return e(n.updates,r)})}})}catch(e){return Promise.reject(e)}}(n.updates,function(){return r}).then(function(e){return o(),Ue(e)}).catch(function(e){throw console.error(e),o(),e})}throw console.error("Auto Decline: Invalid Response",{service:e,resp:n}),new Error("Auto Decline: Invalid Response")})}catch(e){return Promise.reject(e)}},Ke=function(e,n){try{try{return Promise.resolve(Ve[e.method](e,n))}catch(r){throw console.error("execService(service, msg)",r,{service:e,msg:n}),r}}catch(e){return Promise.reject(e)}},Ve={"HTTP/RPC":Je,"HTTP/POST":Je,"IFRAME/RPC":function(e,n){return new Promise(function(r,t){var o=m.uid();n.data=e.data,Fe(e,{onReady:function(r,t){var i=t.send;try{i({jsonrpc:"2.0",id:o,method:"fcl:sign",params:[n,e.params]})}catch(e){throw e}},onClose:function(){t("Declined: Externally Halted")},onMessage:function(e,n){var i=n.close;try{if("object"!=typeof e.data)return;if("2.0"!==e.data.jsonrpc)return;if(e.data.id!==o)return;var u=ze(e.data.result);switch(u.status){case"APPROVED":r(Ue(u.data)),i();break;case"DECLINED":t("Declined: "+(u.reason||"No reason supplied")),i();break;default:t("Declined: No reason supplied"),i()}}catch(e){throw console.error("execIframeRPC onMessage error",e),e}}})})}};function Ye(e,n,r){if(!e.s){if(r instanceof Xe){if(!r.s)return void(r.o=Ye.bind(null,e,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(Ye.bind(null,e,n),Ye.bind(null,e,2));e.s=n,e.v=r;var t=e.o;t&&t(e)}}var Ze=function(e){try{return fn(),Promise.resolve($e()).then(function(n){var r=Ce(n.services,"authz"),t=Ce(n.services,"pre-authz");return q({},e,t?{tempId:"CURRENT_USER",resolve:function(e,n){try{return Promise.resolve(Ke(t,n)).then(pn)}catch(e){return Promise.reject(e)}}}:{tempId:"CURRENT_USER",resolve:null,addr:u.sansPrefix(r.identity.address),keyId:r.identity.keyId,sequenceNum:null,signature:null,signingFunction:function(e){try{return Promise.resolve(Ke(r,e))}catch(e){return Promise.reject(e)}}})})}catch(e){return Promise.reject(e)}},Xe=function(){function e(){}return e.prototype.then=function(n,r){var t=new e,o=this.s;if(o){var i=1&o?n:r;if(i){try{Ye(t,1,i(this.v))}catch(e){Ye(t,2,e)}return t}return this}return this.o=function(e){try{var o=e.v;1&e.s?Ye(t,1,n?n(o):o):r?Ye(t,1,r(o)):Ye(t,2,o)}catch(e){Ye(t,2,e)}},t},e}();function We(e){return e instanceof Xe&&1&e.s}var $e=function(){try{return Promise.resolve(new Promise(function(e){try{return fn(),Promise.resolve(hn()).then(function(r){return r.loggedIn&&dn(r)?e(r):Promise.resolve(n.config().get("challenge.handshake")).then(function(n){var r,t,o,i=(r={handshake:n,l6n:window.location.origin},t=r.l6n,(o=new URL(r.handshake)).searchParams.append("l6n",t),function(e){if(!document.getElementById("FCL_IFRAME")){var n=document.createElement("iframe");return n.src=e,n.id="FCL_IFRAME",n.allow="usb *",n.frameBorder="0",n.style.cssText="\n    position:fixed;\n    top: 0px;\n    right: 0px;\n    bottom: 0px;\n    left: 0px;\n    height: 100vh;\n    width: 100vw;\n    display:block;\n    background:rgba(0,0,0,0.25);\n    z-index: 2147483647;\n    box-sizing: border-box;\n  ",document.body.append(n),[n,function(){document.getElementById("FCL_IFRAME")&&document.getElementById("FCL_IFRAME").remove()}]}}(o.href))[1];window.addEventListener("message",function n(r){var t=r.data;try{return t.type===on||t.type===rn?(i(),window.removeEventListener("message",n),Promise.resolve()):t.type!==tn?Promise.resolve():(i(),window.removeEventListener("message",n),Promise.resolve(function(e){try{var n=(e=function(e){return e.addr=e.addr?u.withPrefix(e.addr):null,e.paddr=e.paddr?u.withPrefix(e.paddr):null,e}(e)).services||[];return Promise.resolve(function(e,n){try{if(null==e||null==n)return Promise.resolve([]);var r=new URL(e);return r.searchParams.append("code",n),Promise.resolve(fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()})).then(function(e){if(Array.isArray(e))return e;var n=[];if(Array.isArray(e.authorizations))for(var r,t=F(e.authorizations);!(r=t()).done;)n.push(q({type:"authz",keyId:e.keyId},r.value));return null!=e.provider&&n.push(q({type:"authn",id:"wallet-provider#authn"},e.provider)),n})}catch(e){return Promise.reject(e)}}(e.hks,e.code)).then(function(r){var t,o,i=(t=n,o=r,void 0===t&&(t=[]),void 0===o&&(o=[]),[].concat(t,o)).map(function(n){return function(e,n){try{return Be[e.type](e,n)}catch(n){return console.error("Unrecognized FCL Service Type ["+e.type+"]",e,n),e}}(n,e)}),a=function(e,n){return n.find(function(e){return"authn"===e.type})}(0,i);return q({},je,{addr:u.withPrefix(e.addr),cid:Te(a),loggedIn:!0,services:i,expiresAt:e.exp})})}catch(e){return Promise.reject(e)}}(t)).then(function(n){return c.send(Qe,nn,n),Promise.resolve(hn()).then(function(n){e(n)})}))}catch(e){return Promise.reject(e)}})})})}catch(e){return Promise.reject(e)}}))}catch(e){return Promise.reject(e)}},Qe="CURRENT_USER",en="CURRENT_USER/UPDATED",nn="SET_CURRENT_USER",rn="FCL::CANCEL",tn="FCL::CHALLENGE::RESPONSE",on="FCL::CHALLENGE::CANCEL",un='{\n  "f_type": "User",\n  "f_vsn": "1.0.0",\n  "addr":null,\n  "cid":null,\n  "loggedIn":null,\n  "expiresAt":null,\n  "services":[]\n}',an=function(e){try{return sessionStorage.setItem(Qe,JSON.stringify(e)),Promise.resolve(e)}catch(e){return Promise.reject(e)}},sn=function(){return n.config().get("persistSession",!0)},cn=((Me={})[c.INIT]=function(e){try{return e.merge(JSON.parse(un)),Promise.resolve(sn()).then(function(n){var r=function(){if(n)return Promise.resolve(function(){try{var e=JSON.parse(un),n=JSON.parse(sessionStorage.getItem(Qe));return null!=n&&e.f_vsn!==n.f_vsn?(sessionStorage.removeItem(Qe),Promise.resolve(e)):Promise.resolve(n||e)}catch(e){return Promise.reject(e)}}()).then(function(n){dn(n)&&e.merge(n)})}();if(r&&r.then)return r.then(function(){})})}catch(e){return Promise.reject(e)}},Me[c.SUBSCRIBE]=function(e,n){e.subscribe(n.from),e.send(n.from,en,q({},e.all()))},Me[c.UNSUBSCRIBE]=function(e,n){e.unsubscribe(n.from)},Me.SNAPSHOT=function(e,n){try{return n.reply(q({},e.all())),Promise.resolve()}catch(e){return Promise.reject(e)}},Me[nn]=function(e,n,r){try{return e.merge(r),Promise.resolve(sn()).then(function(n){n&&an(e.all()),e.broadcast(en,q({},e.all()))})}catch(e){return Promise.reject(e)}},Me.DEL_CURRENT_USER=function(e,n){try{return e.merge(JSON.parse(un)),Promise.resolve(sn()).then(function(n){n&&an(e.all()),e.broadcast(en,q({},e.all()))})}catch(e){return Promise.reject(e)}},Me),fn=function(){return c.spawn(cn,Qe)};function dn(e){return null==e.expiresAt||0===e.expiresAt||e.expiresAt>Date.now()}function ln(){fn(),c.send(Qe,"DEL_CURRENT_USER")}function pn(e){var n=function(e){return{f_type:"PreAuthzResponse",f_vsn:"1.0.0",proposer:(e||{}).proposer,payer:(e||{}).payer||[],authorization:(e||{}).authorization||[]}}(e),r=[];null!=n.proposer&&r.push(["PROPOSER",n.proposer]);for(var t,o=F(n.payer||[]);!(t=o()).done;)r.push(["PAYER",t.value]);for(var i,u=F(n.authorization||[]);!(i=u()).done;)r.push(["AUTHORIZER",i.value]);return r.map(function(e){var n=e[0],r=e[1];return{tempId:[r.identity.address,r.identity.keyId].join("|"),addr:r.identity.address,keyId:r.identity.keyId,signingFunction:function(e){return Ke(r,e)},role:{proposer:"PROPOSER"===n,payer:"PAYER"===n,authorizer:"AUTHORIZER"===n}}})}function mn(e){fn();var n=c.spawn(function(n){try{var r;return n.send(Qe,c.SUBSCRIBE),Promise.resolve(function(e,n,r){for(var t;;){var o=e();if(We(o)&&(o=o.v),!o)return i;if(o.then){t=0;break}var i=r();if(i&&i.then){if(!We(i)){t=1;break}i=i.s}}var u=new Xe,a=Ye.bind(null,u,2);return(0===t?o.then(c):1===t?i.then(s):(void 0).then(function(){(o=e())?o.then?o.then(c).then(void 0,a):c(o):Ye(u,1,i)})).then(void 0,a),u;function s(n){i=n;do{if(!(o=e())||We(o)&&!o.v)return void Ye(u,1,i);if(o.then)return void o.then(c).then(void 0,a);We(i=r())&&(i=i.v)}while(!i||!i.then);i.then(s).then(void 0,a)}function c(e){e?(i=r())&&i.then?i.then(s).then(void 0,a):s(i):Ye(u,1,i)}}(function(){return!r&&1},0,function(){return Promise.resolve(n.receive()).then(function(t){if("@EXIT"===t.tag)return n.send(Qe,c.UNSUBSCRIBE),void(r=1);e(t.data)})}))}catch(e){return Promise.reject(e)}});return function(){return c.send(n,"@EXIT")}}function hn(){return fn(),c.send(Qe,"SNAPSHOT",null,{expectReply:!0,timeout:0})}var vn=function(){return{authenticate:$e,unauthenticate:ln,authorization:Ze,subscribe:mn,snapshot:hn}},yn=vn().authorization;Object.defineProperty(e,"config",{enumerable:!0,get:function(){return n.config}}),Object.defineProperty(e,"isBad",{enumerable:!0,get:function(){return r.isBad}}),Object.defineProperty(e,"isOk",{enumerable:!0,get:function(){return r.isOk}}),Object.defineProperty(e,"pipe",{enumerable:!0,get:function(){return r.pipe}}),Object.defineProperty(e,"why",{enumerable:!0,get:function(){return r.why}}),Object.defineProperty(e,"latestBlock",{enumerable:!0,get:function(){return o.latestBlock}}),Object.defineProperty(e,"account",{enumerable:!0,get:function(){return i.account}}),Object.defineProperty(e,"display",{enumerable:!0,get:function(){return u.display}}),Object.defineProperty(e,"sansPrefix",{enumerable:!0,get:function(){return u.sansPrefix}}),Object.defineProperty(e,"withPrefix",{enumerable:!0,get:function(){return u.withPrefix}}),Object.defineProperty(e,"send",{enumerable:!0,get:function(){return f.send}}),Object.defineProperty(e,"decode",{enumerable:!0,get:function(){return d.decode}}),Object.defineProperty(e,"getTransactionStatus",{enumerable:!0,get:function(){return l.getTransactionStatus}}),Object.defineProperty(e,"getEvents",{enumerable:!0,get:function(){return p.getEvents}}),Object.defineProperty(e,"cadence",{enumerable:!0,get:function(){return h.template}}),Object.defineProperty(e,"cdc",{enumerable:!0,get:function(){return h.template}}),Object.defineProperty(e,"transaction",{enumerable:!0,get:function(){return v.transaction}}),Object.defineProperty(e,"script",{enumerable:!0,get:function(){return y.script}}),Object.defineProperty(e,"ping",{enumerable:!0,get:function(){return g.ping}}),Object.defineProperty(e,"getAccount",{enumerable:!0,get:function(){return b.getAccount}}),Object.defineProperty(e,"getLatestBlock",{enumerable:!0,get:function(){return P.getLatestBlock}}),Object.defineProperty(e,"getBlockById",{enumerable:!0,get:function(){return k.getBlockById}}),Object.defineProperty(e,"getBlockByHeight",{enumerable:!0,get:function(){return w.getBlockByHeight}}),Object.defineProperty(e,"authorization",{enumerable:!0,get:function(){return I.authorization}}),Object.defineProperty(e,"authorizations",{enumerable:!0,get:function(){return I.authorizations}}),Object.defineProperty(e,"arg",{enumerable:!0,get:function(){return E.arg}}),Object.defineProperty(e,"args",{enumerable:!0,get:function(){return E.args}}),Object.defineProperty(e,"proposer",{enumerable:!0,get:function(){return S.proposer}}),Object.defineProperty(e,"payer",{enumerable:!0,get:function(){return j.payer}}),Object.defineProperty(e,"limit",{enumerable:!0,get:function(){return A.limit}}),Object.defineProperty(e,"ref",{enumerable:!0,get:function(){return O.ref}}),Object.defineProperty(e,"param",{enumerable:!0,get:function(){return x.param}}),Object.defineProperty(e,"params",{enumerable:!0,get:function(){return x.params}}),e.VERSION="0.0.67",e.authenticate=function(){return vn().authenticate()},e.authz=yn,e.currentUser=vn,e.events=function(e){return{subscribe:function(n){return c.subscriber(e,Ie,n)}}},e.logIn=function(){return vn().authenticate()},e.reauthenticate=function(){return vn().unauthenticate(),vn().authenticate()},e.serialize=function(e,t){void 0===e&&(e=[]),void 0===t&&(t={});try{return Promise.resolve(n.config().get("sdk.resolve",t.resolve||s.resolve(t))).then(function(n){function t(){return Promise.resolve(n(e)).then(function(e){return JSON.stringify(e,null,2)})}var o=function(){if(Array.isArray(e))return Promise.resolve(r.pipe(r.interaction(),e)).then(function(n){e=n})}();return o&&o.then?o.then(t):t()})}catch(e){return Promise.reject(e)}},e.signUp=function(){return vn().authenticate()},e.tx=Pe,e.unauthenticate=function(){return vn().unauthenticate()}});
//# sourceMappingURL=fcl.umd.js.map
