{"version":3,"file":"fcl.umd.js","sources":["../src/default-config.js","../src/resolvers/resolve-cadence.js","../src/resolvers/resolve-arguments.js","../src/resolvers/resolve-accounts.js","../node_modules/@onflow/encode/dist/encode.module.js","../src/resolvers/resolve-signatures.js","../src/temp.js","../src/resolvers/resolve-final-normalization.js","../src/transaction/index.js","../src/events/index.js","../src/current-user/normalize/__vsn.js","../src/current-user/normalize/frame.js","../src/current-user/normalize/back-channel-rpc.js","../src/current-user/normalize/service.js","../src/current-user/normalize/pre-authz.js","../src/current-user/normalize/authz.js","../src/current-user/normalize/authn.js","../src/current-user/build-user.js","../src/current-user/service-of-type.js","../src/current-user/exec-service/strategies/utils/service-endpoint.js","../src/current-user/exec-service/strategies/utils/fetch-service.js","../src/current-user/normalize/polling-response.js","../src/current-user/normalize/composite-signature.js","../src/current-user/exec-service/strategies/utils/render-frame.js","../src/current-user/exec-service/strategies/utils/frame.js","../src/current-user/exec-service/strategies/utils/poll.js","../src/current-user/exec-service/strategies/http-post.js","../src/current-user/exec-service/index.js","../src/current-user/exec-service/strategies/iframe-rpc.js","../src/current-user/index.js","../src/current-user/render-authn-frame.js","../src/current-user/render-frame.js","../src/current-user/fetch-services.js","../src/current-user/merge-services.js","../src/fcl.js","../src/serialize/index.js"],"sourcesContent":["import {config} from \"@onflow/config\"\n\nconfig()\n  .put(\"accessNode.api\", \"http://localhost:8080\")\n  .put(\"challenge.handshake\", \"http://localhost:8700/authenticate\")\n","import {isTransaction, isScript, get} from \"@onflow/interaction\"\nimport {invariant} from \"@onflow/util-invariant\"\nimport {config} from \"@onflow/config\"\n\nconst isFn = v => typeof v === \"function\"\nconst isString = v => typeof v === \"string\"\n\nexport async function resolveCadence(ix) {\n  if (isTransaction(ix) || isScript(ix)) {\n    var cadence = get(ix, \"ix.cadence\")\n    invariant(\n      isFn(cadence) || isString(cadence),\n      \"Cadence needs to be a function or a string.\"\n    )\n    if (isFn(cadence)) cadence = await cadence({})\n    invariant(isString(cadence), \"Cadence needs to be a string at this point.\")\n    ix.message.cadence = await config()\n      .where(/^0x/)\n      .then(d =>\n        Object.entries(d).reduce(\n          (cadence, [key, value]) => cadence.replace(key, value),\n          cadence\n        )\n      )\n  }\n\n  return ix\n}\n","import {invariant} from \"@onflow/util-invariant\"\nimport {isTransaction, isScript} from \"@onflow/interaction\"\n\nconst isFn = v => typeof v === \"function\"\n\nfunction cast(arg) {\n  // prettier-ignore\n  invariant(typeof arg.xform != null, `No type specified for argument: ${arg.value}`)\n\n  if (isFn(arg.xform)) return arg.xform(arg.value)\n  if (isFn(arg.xform.asArgument)) return arg.xform.asArgument(arg.value)\n\n  // prettier-ignore\n  invariant(false, `Invalid Argument`, arg)\n}\n\nexport async function resolveArguments(ix) {\n  if (isTransaction(ix) || isScript(ix)) {\n    for (let [id, arg] of Object.entries(ix.arguments)) {\n      ix.arguments[id].asArgument = cast(arg)\n    }\n  }\n\n  return ix\n}\n","import {invariant} from \"@onflow/util-invariant\"\nimport {isTransaction} from \"@onflow/interaction\"\n\nconst isFn = v => typeof v === \"function\"\n\nfunction buildPreSignable(acct, ix) {\n  try {\n    return {\n      f_type: \"PreSignable\",\n      f_vsn: \"1.0.0\",\n      roles: acct.role,\n      cadence: ix.message.cadence,\n      args: ix.message.arguments.map(d => ix.arguments[d].asArgument),\n      data: {},\n      interaction: ix,\n    }\n  } catch (error) {\n    console.error(\"buildPreSignable\", error)\n    throw error\n  }\n}\n\nasync function collectAccounts(ix, accounts, last, depth = 3) {\n  invariant(depth, \"Account Resolve Recursion Limit Exceeded\", {ix, accounts})\n\n  let authorizations = []\n  for (let ax of accounts) {\n    var old = last || ax\n    if (isFn(ax.resolve)) ax = await ax.resolve(ax, buildPreSignable(ax, ix))\n\n    if (Array.isArray(ax)) {\n      await collectAccounts(ix, ax, old, depth - 1)\n    } else {\n      ix.accounts[ax.tempId] = ix.accounts[ax.tempId] || ax\n      ix.accounts[ax.tempId].role.proposer =\n        ix.accounts[ax.tempId].role.proposer || ax.role.proposer\n      ix.accounts[ax.tempId].role.payer =\n        ix.accounts[ax.tempId].role.payer || ax.role.payer\n      ix.accounts[ax.tempId].role.authorizer =\n        ix.accounts[ax.tempId].role.authorizer || ax.role.authorizer\n\n      if (ix.accounts[ax.tempId].role.proposer && ix.proposer === old.tempId) {\n        ix.proposer = ax.tempId\n      }\n\n      if (ix.accounts[ax.tempId].role.payer && ix.payer === old.tempId) {\n        ix.payer = ax.tempId\n      }\n\n      if (ix.accounts[ax.tempId].role.authorizer) {\n        if (last) {\n          // do group replacement\n          authorizations = [...authorizations, ax.tempId]\n        } else {\n          // do 1-1 replacement\n          ix.authorizations = ix.authorizations.map(d =>\n            d === old.tempId ? ax.tempId : d\n          )\n        }\n      }\n    }\n    if (old.tempId != ax.tempId) delete ix.accounts[old.tempId]\n  }\n\n  if (last) {\n    // complete (flatmap) group replacement\n    ix.authorizations = ix.authorizations\n      .map(d => (d === last.tempId ? authorizations : d))\n      .reduce(\n        (prev, curr) =>\n          Array.isArray(curr) ? [...prev, ...curr] : [...prev, curr],\n        []\n      )\n  }\n}\n\nexport async function resolveAccounts(ix) {\n  if (isTransaction(ix)) {\n    try {\n      await collectAccounts(ix, Object.values(ix.accounts))\n      await collectAccounts(ix, Object.values(ix.accounts))\n    } catch (error) {\n      console.error(\"=== SAD PANDA ===\\n\\n\", error, \"\\n\\n=== SAD PANDA ===\")\n      throw error\n    }\n  }\n  return ix\n}\n","import{encode as n}from\"@onflow/rlp\";var e=function(n){return c(a(n))},r=function(n){return c(i(n))},t=function(n,e){return Buffer.from(n.padStart(2*e,0),\"hex\")},o=function(n){return t(n,8)},u=function(n){return Buffer.from(JSON.stringify(n),\"utf8\")},c=function(e){return n(e).toString(\"hex\")},a=function(n){return d(n),[(r=n.script,Buffer.from(r,\"utf8\")),n.arguments.map(u),(e=n.refBlock,t(e,32)),n.gasLimit,o(n.proposalKey.address),n.proposalKey.keyId,n.proposalKey.sequenceNum,o(n.payer),n.authorizers.map(o)];var e,r},i=function(n){return p(n),[a(n),f(n)]},f=function(n){var e=s(n);return n.payloadSigs.map(function(n){return{signerIndex:e.get(n.address),keyId:n.keyId,sig:n.sig}}).sort(function(n,e){return n.signerIndex>e.signerIndex?1:n.signerIndex<e.signerIndex?-1:n.keyId>e.keyId?1:n.keyId<e.keyId?-1:void 0}).map(function(n){return[n.signerIndex,n.keyId,(e=n.sig,Buffer.from(e,\"hex\"))];var e})},s=function(n){var e=new Map,r=0,t=function(n){e.has(n)||(e.set(n,r),r++)};return t(n.proposalKey.address),t(n.payer),n.authorizers.forEach(t),e},d=function(n){k.forEach(function(e){return v(n,e)}),g.forEach(function(e){return v(n.proposalKey,e,\"proposalKey\")})},p=function(n){I.forEach(function(e){return v(n,e)}),n.payloadSigs.forEach(function(n,e){x.forEach(function(r){return v(n,r,\"payloadSigs\",e)})})},l=function(n){return\"number\"==typeof n},m=function(n){return\"string\"==typeof n},h=function(n){return null!==n&&\"object\"==typeof n},y=function(n){return h(n)&&n instanceof Array},k=[{name:\"script\",check:m},{name:\"arguments\",check:y},{name:\"refBlock\",check:m,defaultVal:\"0\"},{name:\"gasLimit\",check:l},{name:\"proposalKey\",check:h},{name:\"payer\",check:m},{name:\"authorizers\",check:y}],g=[{name:\"address\",check:m},{name:\"keyId\",check:l},{name:\"sequenceNum\",check:l}],I=[{name:\"payloadSigs\",check:y}],x=[{name:\"address\",check:m},{name:\"keyId\",check:l},{name:\"sig\",check:m}],v=function(n,e,r,t){var o=e.name,u=e.check,c=e.defaultVal;if(null==n[o]&&null!=c&&(n[o]=c),null==n[o])throw K(o,r,t);if(!u(n[o]))throw S(o,r,t)},E=function(n,e,r){return e?null==r?e+\".\"+n:e+\".\"+r+\".\"+n:n},K=function(n,e,r){return new Error(\"Missing field \"+E(n,e,r))},S=function(n,e,r){return new Error(\"Invalid field \"+E(n,e,r))};export{r as encodeTransactionEnvelope,e as encodeTransactionPayload};\n//# sourceMappingURL=encode.module.js.map\n","import {isTransaction} from \"@onflow/interaction\"\nimport {sansPrefix} from \"@onflow/util-address\"\nimport {\n  encodeTransactionPayload as encodeInsideMessage,\n  encodeTransactionEnvelope as encodeOutsideMessage,\n} from \"@onflow/encode\"\n\nexport async function resolveSignatures(ix) {\n  if (isTransaction(ix)) {\n    try {\n      let insideSigners = findInsideSigners(ix)\n      const insidePayload = encodeInsideMessage(prepForEncoding(ix))\n      await Promise.all(insideSigners.map(fetchSignature(ix, insidePayload)))\n\n      let outsideSigners = findOutsideSigners(ix)\n      const outsidePayload = encodeOutsideMessage({\n        ...prepForEncoding(ix),\n        payloadSigs: insideSigners.map(id => ({\n          address: ix.accounts[id].addr,\n          keyId: ix.accounts[id].keyId,\n          sig: ix.accounts[id].signature,\n        })),\n      })\n      await Promise.all(outsideSigners.map(fetchSignature(ix, outsidePayload)))\n    } catch (error) {\n      console.error(\"Signatures\", error, {ix})\n      throw error\n    }\n  }\n  return ix\n}\n\nfunction findInsideSigners(ix) {\n  // Inside Signers Are: (authorizers + proposer) - payer\n  let inside = new Set(ix.authorizations)\n  inside.add(ix.proposer)\n  inside.delete(ix.payer)\n  return Array.from(inside)\n}\n\nfunction findOutsideSigners(ix) {\n  // Outside Signers Are: (payer)\n  let outside = new Set([ix.payer])\n  return Array.from(outside)\n}\n\nfunction fetchSignature(ix, payload) {\n  return async function innerFetchSignature(id) {\n    const acct = ix.accounts[id]\n    if (acct.signature != null) return\n    const {signature} = await acct.signingFunction(\n      buildSignable(acct, payload, ix)\n    )\n    // if (!acct.role.proposer) {\n    //   ix.accounts[id].keyId = keyId\n    // }\n    ix.accounts[id].signature = signature\n  }\n}\n\nfunction buildSignable(acct, message, ix) {\n  try {\n    return {\n      f_type: \"Signable\",\n      f_vsn: \"1.0.0\",\n      message,\n      addr: sansPrefix(acct.addr),\n      keyId: acct.keyId,\n      roles: acct.role,\n      cadence: ix.message.cadence,\n      args: ix.message.arguments.map(d => ix.arguments[d].asArgument),\n      data: {},\n      interaction: ix,\n    }\n  } catch (error) {\n    console.error(\"buildSignable\", error)\n    throw error\n  }\n}\n\nfunction prepForEncoding(ix) {\n  return {\n    script: ix.message.cadence,\n    refBlock: ix.message.refBlock || null,\n    gasLimit: ix.message.computeLimit,\n    arguments: ix.message.arguments.map(id => ix.arguments[id].asArgument),\n    proposalKey: {\n      address: sansPrefix(ix.accounts[ix.proposer].addr),\n      keyId: ix.accounts[ix.proposer].keyId,\n      sequenceNum: ix.accounts[ix.proposer].sequenceNum,\n    },\n    payer: sansPrefix(ix.accounts[ix.payer].addr),\n    authorizers: ix.authorizations\n      .map(cid => sansPrefix(ix.accounts[cid].addr))\n      .reduce((prev, current) => {\n        return prev.find(item => item === current) ? prev : [...prev, current]\n      }, []),\n  }\n}\n","import {pipe} from \"@onflow/interaction\"\nimport {config} from \"@onflow/config\"\nimport {invariant} from \"@onflow/util-invariant\"\nimport {isTransaction} from \"@onflow/interaction\"\nimport {latestBlock} from \"@onflow/sdk-latest-block\"\nimport {account as fetchAccount} from \"@onflow/sdk-account\"\n\nimport {resolveCadence} from \"./resolvers/resolve-cadence.js\"\nimport {resolveArguments} from \"./resolvers/resolve-arguments.js\"\nimport {resolveAccounts} from \"./resolvers/resolve-accounts.js\"\nimport {resolveSignatures} from \"./resolvers/resolve-signatures.js\"\nimport {resolveFinalNormalization} from \"./resolvers/resolve-final-normalization.js\"\n\nexport const resolve = pipe([\n  resolveCadence,\n  resolveArguments,\n  resolveAccounts,\n  /* special */ execFetchRef,\n  /* special */ execFetchSequenceNumber,\n  resolveSignatures,\n  resolveFinalNormalization,\n])\n\nconfig().put(\"sdk.resolve\", resolve)\n\nasync function execFetchRef(ix) {\n  if (isTransaction(ix) && ix.message.refBlock == null) {\n    ix.message.refBlock = (await latestBlock()).id\n  }\n  return ix\n}\n\nasync function execFetchSequenceNumber(ix) {\n  if (isTransaction(ix)) {\n    var acct = Object.values(ix.accounts).find(a => a.role.proposer)\n    invariant(acct, `Transactions require a proposer`)\n    if (acct.sequenceNum == null) {\n      ix.accounts[acct.tempId].sequenceNum = await fetchAccount(acct.addr)\n        .then(acct => acct.keys)\n        .then(keys => keys.find(key => key.index === acct.keyId))\n        .then(key => key.sequenceNumber)\n    }\n  }\n  return ix\n}\n","import {sansPrefix} from \"@onflow/util-address\"\n\nexport async function resolveFinalNormalization(ix) {\n  for (let key of Object.keys(ix.accounts)) {\n    ix.accounts[key].addr = sansPrefix(ix.accounts[key].addr)\n  }\n  return ix\n}\n","import \"../default-config\"\nimport {config} from \"@onflow/config\"\nimport {\n  spawn,\n  send,\n  subscriber,\n  snapshoter,\n  UPDATED,\n  SNAPSHOT,\n  INIT,\n  SUBSCRIBE,\n  UNSUBSCRIBE,\n} from \"@onflow/util-actor\"\nimport {send as fclSend} from \"@onflow/sdk-send\"\nimport {decode} from \"@onflow/sdk-decode\"\nimport {getTransactionStatus} from \"@onflow/sdk-build-transaction-status\"\n\nconst RATE = 2500\nconst POLL = \"POLL\"\n\nconst fetchTxStatus = async (transactionId) => {\n  return fclSend([getTransactionStatus(transactionId)]).then(decode)\n}\n\nconst isExpired = (tx) => tx.status === 5\nconst isSealed = (tx) => tx.status >= 4\nconst isExecuted = (tx) => tx.status >= 3\nconst isFinalized = (tx) => tx.status >= 2\nconst isPending = (tx) => tx.status >= 1\nconst isUnknown = (tx) => tx.status >= 0\n\nconst isDiff = (cur, next) => {\n  return JSON.stringify(cur) !== JSON.stringify(next)\n}\n\nconst HANDLERS = {\n  [INIT]: async (ctx) => {\n    const tx = await fetchTxStatus(ctx.self())\n    if (!isSealed(tx)) setTimeout(() => ctx.sendSelf(POLL), RATE)\n    ctx.merge(tx)\n  },\n  [SUBSCRIBE]: (ctx, letter) => {\n    ctx.subscribe(letter.from)\n    ctx.send(letter.from, UPDATED, ctx.all())\n  },\n  [UNSUBSCRIBE]: (ctx, letter) => {\n    ctx.unsubscribe(letter.from)\n  },\n  [SNAPSHOT]: async (ctx, letter) => {\n    letter.reply(ctx.all())\n  },\n  [POLL]: async (ctx) => {\n    const tx = await fetchTxStatus(ctx.self())\n    if (!isSealed(tx)) setTimeout(() => ctx.sendSelf(POLL), RATE)\n    if (isDiff(ctx.all(), tx)) ctx.broadcast(UPDATED, tx)\n    ctx.merge(tx)\n  },\n}\n\nconst scoped = (transactionId) => {\n  if (typeof transactionId === \"object\")\n    transactionId = transactionId.transactionId\n  if (transactionId == null) throw new Error(\"transactionId required\")\n  return transactionId\n}\n\nconst spawnTransaction = (transactionId) => {\n  return spawn(HANDLERS, scoped(transactionId))\n}\n\nexport function transaction(transactionId) {\n  function snapshot() {\n    return snapshoter(transactionId, spawnTransaction)\n  }\n\n  function subscribe(callback) {\n    return subscriber(scoped(transactionId), spawnTransaction, callback)\n  }\n\n  function once(predicate) {\n    return function innerOnce(opts = {}) {\n      const suppress = opts.suppress || false\n      return new Promise((resolve, reject) => {\n        const unsub = subscribe((txStatus) => {\n          if (txStatus.statusCode && !suppress) {\n            reject(txStatus.errorMessage)\n            unsub()\n          } else if (predicate(txStatus)) {\n            resolve(txStatus)\n            unsub()\n          }\n        })\n      })\n    }\n  }\n\n  return {\n    snapshot,\n    subscribe,\n    onceFinalized: once(isFinalized),\n    onceExecuted: once(isExecuted),\n    onceSealed: once(isSealed),\n  }\n}\n\ntransaction.isUnknown = isUnknown\ntransaction.isPending = isPending\ntransaction.isFinalized = isFinalized\ntransaction.isExecuted = isExecuted\ntransaction.isSealed = isSealed\ntransaction.isExpired = isExpired\n","import {spawn, subscriber, SUBSCRIBE, UNSUBSCRIBE} from \"@onflow/util-actor\"\nimport {config} from \"@onflow/config\"\nimport {latestBlock} from \"@onflow/sdk-latest-block\"\nexport {getEvents} from \"@onflow/sdk-build-get-events\"\nimport {send} from \"@onflow/sdk-send\"\nimport {decode} from \"@onflow/sdk-decode\"\n\nconst RATE = 10000\nconst UPDATED = \"UPDATED\"\nconst TICK = \"TICK\"\n\nconst scheduleTick = async ctx => {\n  return setTimeout(\n    () => ctx.sendSelf(TICK),\n    await config().get(\"fcl.eventPollRate\", RATE)\n  )\n}\n\nconst HANDLERS = {\n  [TICK]: async ctx => {\n    if (!ctx.hasSubs()) return\n    let hwm = ctx.get(\"hwm\")\n    if (hwm == null) {\n      ctx.put(\"hwm\", await latestBlock())\n      ctx.put(\"tick\", await scheduleTick(ctx))\n    } else {\n      let next = await latestBlock()\n      ctx.put(\"hwm\", next)\n      const data = await send([\n        getEvents(ctx.self(), hwm.height, next.height - 1),\n      ]).then(decode)\n      for (let d of data) ctx.broadcast(UPDATED, d.data)\n      ctx.put(\"tick\", await scheduleTick(ctx))\n    }\n  },\n  [SUBSCRIBE]: async (ctx, letter) => {\n    if (!ctx.hasSubs()) {\n      ctx.put(\"tick\", await scheduleTick(ctx))\n    }\n    ctx.subscribe(letter.from)\n  },\n  [UNSUBSCRIBE]: (ctx, letter) => {\n    ctx.unsubscribe(letter.from)\n    if (!ctx.hasSubs()) {\n      clearTimeout(ctx.get(\"tick\"))\n      ctx.delete(\"tick\")\n      ctx.delete(\"hwm\")\n    }\n  },\n}\n\nconst spawnEvents = key => spawn(HANDLERS, key)\n\nexport function events(key) {\n  return {\n    subscribe: callback => subscriber(key, spawnEvents, callback),\n  }\n}\n","export const SERVICE_PRAGMA = {\n  f_type: \"Service\",\n  f_vsn: \"1.0.0\",\n}\n\nexport const IDENTITY_PRAGMA = {\n  f_type: \"Identity\",\n  f_vsn: \"1.0.0\",\n}\n\nexport const PROVIDER_PRAGME = {\n  f_type: \"Provider\",\n  f_vsn: \"1.0.0\",\n}\n\nexport const USER_PRAGMA = {\n  f_type: \"USER\",\n  f_vsn: \"1.0.0\",\n}\n\nexport const POLLING_RESPONSE_PRAGMA = {\n  f_type: \"PollingResponse\",\n  f_vsn: \"1.0.0\",\n}\n\nexport const COMPOSITE_SIGNATURE_PRAGMA = {\n  f_type: \"CompositeSignature\",\n  f_vsn: \"1.0.0\",\n}\n","import {SERVICE_PRAGMA} from \"./__vsn\"\n\n// {\n//    \"f_type\": \"Service\",\n//    \"f_vsn\": \"1.0.0\",\n//    \"type\": \"frame\",\n//    \"endpoint\": \"https://rawr\",\n//    \"data\": {},   // Sent to frame when ready\n//    \"params\": {}, // include in query params on frame\n// }\nexport function normalizeFrame(service) {\n  if (service == null) return null\n\n  switch (service[\"f_vsn\"]) {\n    case \"1.0.0\":\n      return service\n\n    default:\n      return {\n        old: service,\n        ...SERVICE_PRAGMA,\n        type: \"frame\",\n        endpoint: service.endpoint,\n        params: service.params || {},\n        data: service.data || {},\n      }\n  }\n}\n","import {SERVICE_PRAGMA} from \"./__vsn\"\n\n// {\n//    \"f_type\": \"Service\",\n//    \"f_vsn\": \"1.0.0\",\n//    \"type\": \"back-channel-rpc\",\n//    \"endpoint\": \"https://rawr\",\n//    \"method\": \"HTTP/GET\", // HTTP/GET | HTTP/POST\n//    \"data\": {},           // included in body of rpc\n//    \"params\": {},         // included as query params on endpoint url\n// }\nexport function normalizeBackChannelRpc(service) {\n  if (service == null) return null\n\n  switch (service[\"f_vsn\"]) {\n    case \"1.0.0\":\n      return service\n\n    default:\n      return {\n        ...SERVICE_PRAGMA,\n        type: \"back-channel-rpc\",\n        endpoint: service.endpoint,\n        method: service.method,\n        params: service.params || {},\n        data: service.data || {},\n      }\n  }\n}\n","import {normalizeAuthn} from \"./authn\"\nimport {normalizeAuthz} from \"./authz\"\nimport {normalizePreAuthz} from \"./pre-authz\"\nimport {normalizeFrame} from \"./frame\"\nimport {normalizeBackChannelRpc} from \"./back-channel-rpc\"\n\nexport function normalizeServices(services, data) {\n  return services.map((service) => normalizeService(service, data))\n}\n\nconst serviceNormalizers = {\n  \"back-channel-rpc\": normalizeBackChannelRpc,\n  \"pre-authz\": normalizePreAuthz,\n  authz: normalizeAuthz,\n  authn: normalizeAuthn,\n  frame: normalizeFrame,\n}\n\nexport function normalizeService(service, data) {\n  try {\n    var normalized = serviceNormalizers[service.type](service, data)\n    // console.log(service.type, {normalized, service})\n    return normalized\n  } catch (error) {\n    console.error(\n      `Unrecognized FCL Service Type [${service.type}]`,\n      service,\n      error\n    )\n    return service\n  }\n}\n","import {withPrefix} from \"@onflow/util-address\"\nimport {SERVICE_PRAGMA, IDENTITY_PRAGMA} from \"./__vsn\"\n\n// {\n//   \"f_type\": \"service\",\n//   \"f_vsn\": \"1.0.0\",\n//   \"type\": \"pre-authz\",\n//   \"uid\": \"uniqueDedupeKey\",\n//   \"endpoint\": \"https://rawr\",\n//   \"method\": \"HTTP/POST\", // HTTP/POST | IFRAME/RPC | HTTP/RPC\n//   \"identity\": {\n//      \"address\": \"0x______\",\n//      \"keyId\": 0,\n//   },\n//   \"data\": {}, // included in body of pre-authz request\n//   \"params\": {}, // included as query params on endpoint url\n// }\nexport function normalizePreAuthz(service) {\n  if (service == null) return null\n\n  switch (service[\"f_vsn\"]) {\n    case \"1.0.0\":\n      return service\n\n    default:\n      return {\n        ...SERVICE_PRAGMA,\n        type: service.type,\n        uid: service.id,\n        endpoint: service.endpoint,\n        method: service.method,\n        identity: {\n          ...IDENTITY_PRAGMA,\n          address: withPrefix(service.addr),\n          keyId: service.keyId,\n        },\n        params: service.params,\n        data: service.data,\n      }\n  }\n}\n","import {withPrefix} from \"@onflow/util-address\"\nimport {SERVICE_PRAGMA, IDENTITY_PRAGMA} from \"./__vsn\"\n\n// {\n//   \"f_type\": \"service\",\n//   \"f_vsn\": \"1.0.0\",\n//   \"type\": \"authz\",\n//   \"uid\": \"uniqueDedupeKey\",\n//   \"endpoint\": \"https://rawr\",\n//   \"method\": \"HTTP/POST\", // HTTP/POST | IFRAME/RPC | HTTP/RPC\n//   \"identity\": {\n//      \"address\": \"0x______\",\n//      \"keyId\": 0,\n//   },\n//   \"data\": {}, // included in body of authz request\n//   \"params\": {}, // included as query params on endpoint url\n// }\nexport function normalizeAuthz(service) {\n  if (service == null) return null\n\n  switch (service[\"f_vsn\"]) {\n    case \"1.0.0\":\n      return service\n\n    default:\n      return {\n        ...SERVICE_PRAGMA,\n        type: service.type,\n        uid: service.id,\n        endpoint: service.endpoint,\n        method: service.method,\n        identity: {\n          ...IDENTITY_PRAGMA,\n          address: withPrefix(service.addr),\n          keyId: service.keyId,\n        },\n        params: service.params,\n        data: service.data,\n      }\n  }\n}\n","import {withPrefix} from \"@onflow/util-address\"\nimport {SERVICE_PRAGMA} from \"./__vsn\"\n\n// {\n//   \"f_type\": \"Service\",\n//   \"f_vsn\": \"1.0.0\",\n//   \"type\": \"authn\",\n//   \"uid\": \"uniqueDedupeKey\",\n//   \"endpoint\": \"https://rawr\",\n//   \"id\": \"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\", // wallets internal id for the user\n//   \"identity\": {\n//     \"address\": \"0x____\"\n//   },\n//   \"provider\": {\n//     \"address\": \"0x____\",\n//     \"name\": \"Best Wallet\",\n//     \"description\": \"The Best Wallet\"\n//     \"icon\": \"https://\",\n//   }\n// }\nexport function normalizeAuthn(service) {\n  if (service == null) return null\n\n  switch (service[\"f_vsn\"]) {\n    case \"1.0.0\":\n      return service\n\n    default:\n      return {\n        ...SERVICE_PRAGMA,\n        type: service.type,\n        uid: service.id,\n        endpoint: service.authn,\n        id: service.pid,\n        provider: {\n          address: withPrefix(service.addr),\n          name: service.name,\n          icon: service.icon,\n        },\n      }\n  }\n}\n","import {withPrefix} from \"@onflow/util-address\"\nimport * as rlp from \"@onflow/rlp\"\nimport {fetchServices} from \"./fetch-services\"\nimport {mergeServices} from \"./merge-services\"\nimport {USER_PRAGMA} from \"./normalize/__vsn\"\nimport {normalizeService} from \"./normalize/service\"\n\nfunction deriveCompositeId(authn) {\n  return rlp\n    .encode([\n      authn.provider.address || authn.provider.name || \"UNSPECIFIED\",\n      authn.id,\n    ])\n    .toString(\"hex\")\n}\n\nfunction normalizeData(data) {\n  data.addr = data.addr ? withPrefix(data.addr) : null\n  data.paddr = data.paddr ? withPrefix(data.paddr) : null\n  return data\n}\n\nfunction findService(type, services) {\n  return services.find(d => d.type === type)\n}\n\nexport async function buildUser(data) {\n  data = normalizeData(data)\n\n  var services = mergeServices(\n    data.services || [],\n    await fetchServices(data.hks, data.code)\n  ).map(service => normalizeService(service, data))\n\n  const authn = findService(\"authn\", services)\n\n  return {\n    ...USER_PRAGMA,\n    addr: withPrefix(data.addr),\n    cid: deriveCompositeId(authn),\n    loggedIn: true,\n    services: services,\n    expiresAt: data.exp,\n  }\n}\n","export function serviceOfType(services = [], type) {\n  return services.find(service => service.type === type)\n}\n","export function serviceEndpoint(service) {\n  const url = new URL(service.endpoint)\n  url.searchParams.append(\"l6n\", window.location.origin)\n  if (service.params != null) {\n    for (let [key, value] of Object.entries(service.params || {})) {\n      url.searchParams.append(key, value)\n    }\n  }\n  return url\n}\n","import {serviceEndpoint} from \"./service-endpoint\"\n\nexport function fetchService(service, opts = {}) {\n  const method = opts.method || \"POST\"\n  const body =\n    method === \"GET\"\n      ? undefined\n      : JSON.stringify(opts.data || service.data || {})\n\n  return fetch(serviceEndpoint(service), {\n    method: method,\n    headers: {\n      ...(service.headers || {}),\n      ...(opts.headers || {}),\n      \"Content-Type\": \"application/json\",\n    },\n    body: body,\n  }).then((d) => d.json())\n}\n","import {POLLING_RESPONSE_PRAGMA} from \"./__vsn\"\nimport {normalizeBackChannelRpc} from \"./back-channel-rpc\"\nimport {normalizeFrame} from \"./frame\"\n\n// {\n//    \"f_type\": \"PollingResponse\",\n//    \"f_vsn\": \"1.0.0\",\n//    \"status\": \"PENDING\", // PENDING | APPROVED | DECLINED\n//    \"reason\": null,      // Reason for Declining Transaction\n//    \"data\": null,        // Return value for APPROVED\n//    \"updates\": BackChannelRpc,\n//    \"local\": Frame,\n// }\nexport function normalizePollingResponse(resp) {\n  if (resp == null) return null\n\n  switch (resp[\"f_vsn\"]) {\n    case \"1.0.0\":\n      return resp\n\n    default:\n      return {\n        ...POLLING_RESPONSE_PRAGMA,\n        status: resp.status,\n        reason: resp.reason,\n        data: resp.compositeSignature || resp.data || {},\n        updates: normalizeBackChannelRpc(resp.authorizationUpdates),\n        local: normalizeFrame((resp.local || [])[0]),\n      }\n  }\n}\n","import {COMPOSITE_SIGNATURE_PRAGMA} from \"./__vsn\"\nimport {sansPrefix} from \"@onflow/util-address\"\n\n// {\n//    \"f_type\": \"CompositeSignature\",\n//    \"f_vsn\": \"1.0.0\",\n//    \"addr\": \"_____\",         // sans-prefix\n//    \"signature\": \"adfe1234\", // hex\n//    \"keyId\": 3,\n// }\nexport function normalizeCompositeSignature(resp) {\n  if (resp == null) return null\n\n  switch (resp[\"f_vsn\"]) {\n    case \"1.0.0\":\n      return resp\n\n    default:\n      return {\n        ...COMPOSITE_SIGNATURE_PRAGMA,\n        addr: sansPrefix(resp.addr || resp.address),\n        signature: resp.signature || resp.sig,\n        keyId: resp.keyId,\n      }\n  }\n}\n","import {invariant} from \"@onflow/util-invariant\"\n\nconst FRAME = \"FCL_IFRAME\"\n\nconst FRAME_STYLES = `\n  position:fixed;\n  top: 0px;\n  right: 0px;\n  bottom: 0px;\n  left: 0px;\n  height: 100vh;\n  width: 100vw;\n  display:block;\n  background:rgba(0,0,0,0.25);\n  z-index: 2147483647;\n  box-sizing: border-box;\n`\n\nexport function renderFrame(src) {\n  invariant(\n    !document.getElementById(FRAME),\n    \"Attempt at triggering multiple Frames\",\n    {src}\n  )\n\n  const $frame = document.createElement(\"iframe\")\n  $frame.src = src\n  $frame.id = FRAME\n  $frame.allow = \"usb *\"\n  $frame.frameBorder = \"0\"\n  $frame.style.cssText = FRAME_STYLES\n  document.body.append($frame)\n\n  const unmount = () => {\n    if (document.getElementById(FRAME)) {\n      document.getElementById(FRAME).remove()\n    }\n  }\n\n  return [$frame, unmount]\n}\n","import {renderFrame} from \"./render-frame\"\nimport {serviceEndpoint} from \"./service-endpoint\"\n\nconst CLOSE_EVENT = \"FCL:FRAME:CLOSE\"\nconst READY_EVENT = \"FCL:FRAME:READY\"\n\nconst noop = () => {}\n\nconst IGNORE = new Set([\n  \"monetizationstart\",\n  \"monetizationpending\",\n  \"monetizationprogress\",\n  \"monetizationstop\",\n])\n\nexport function frame(service, opts = {}) {\n  console.log(\"FRAME\", {service, opts})\n  if (service == null) return {send: noop, close: noop}\n\n  const onClose = opts.onClose || noop\n  const onMessage = opts.onMessage || noop\n  const onReady = opts.onReady || noop\n\n  window.addEventListener(\"message\", internal)\n  const [$frame, unmount] = renderFrame(serviceEndpoint(service))\n  return {send, close}\n\n  function internal(e) {\n    try {\n      if (typeof e.data !== \"object\") return\n      if (IGNORE.has(e.data.type)) return\n      if (e.data.type === CLOSE_EVENT) close()\n      if (e.data.type === READY_EVENT) onReady(e, {send, close})\n      onMessage(e, {send, close})\n\n      // Backwards Compatible\n      if (e.data.type === \"FCL::AUTHZ_READY\") onReady(e, {send, close})\n      if (e.data.type === \"FCL::CHALLENGE::CANCEL\") close()\n      if (e.data.type === \"FCL::CANCEL\") close()\n    } catch (error) {\n      console.error(\"Frame Callback Error\", error)\n      close()\n    }\n  }\n\n  function close() {\n    try {\n      window.removeEventListener(\"message\", internal)\n      unmount()\n      onClose()\n    } catch (error) {\n      console.error(\"Frame Close Error\", error)\n    }\n  }\n\n  function send(msg) {\n    try {\n      console.log(\"SEND\", msg)\n      $frame.contentWindow.postMessage(\n        JSON.parse(JSON.stringify(msg || {})),\n        \"*\"\n      )\n    } catch (error) {\n      console.error(\"Frame Send Error\", msg, error)\n    }\n  }\n}\n","import {normalizePollingResponse} from \"../../../normalize/polling-response\"\nimport {serviceEndpoint} from \"./service-endpoint\"\nimport {invariant} from \"@onflow/util-invariant\"\nimport {fetchService} from \"./fetch-service\"\n\nconst OPTIONS = {\n  \"HTTP/GET\": \"GET\",\n  \"HTTP/POST\": \"POST\",\n}\n\nconst serviceMethod = service => {\n  invariant(\n    OPTIONS[service.method],\n    \"Invalid Service Method for type back-channel-rpc\",\n    {service}\n  )\n  return OPTIONS[service.method]\n}\n\nconst serviceBody = service => {\n  if (service.method === \"HTTP/GET\") return undefined\n  if (service.method === \"HTTP/POST\" && service.data != null)\n    return JSON.stringify(service.data)\n  return undefined\n}\n\nexport async function poll(service, canContinue = () => true) {\n  invariant(service, \"Missing Polling Service\", {service})\n  if (!canContinue()) throw new Error(\"Externally Halted\")\n\n  const resp = await fetchService(service, {\n    method: serviceMethod(service),\n  }).then(normalizePollingResponse)\n\n  switch (resp.status) {\n    case \"APPROVED\":\n      return resp.data\n    case \"DECLINED\":\n      throw new Error(`Declined: ${resp.reason || \"No reason supplied.\"}`)\n    default:\n      await new Promise(r => setTimeout(r, 500))\n      return poll(resp.updates, canContinue)\n  }\n}\n","import {fetchService} from \"./utils/fetch-service\"\nimport {serviceEndpoint} from \"./utils/service-endpoint\"\nimport {normalizePollingResponse} from \"../../normalize/polling-response\"\nimport {normalizeCompositeSignature} from \"../../normalize/composite-signature\"\nimport {frame} from \"./utils/frame\"\nimport {poll} from \"./utils/poll\"\n\nexport async function execHttpPost(service, signable) {\n  signable.data = service.data\n  const resp = await fetchService(service, {\n    data: signable,\n  }).then(normalizePollingResponse)\n\n  if (resp.status === \"APPROVED\") {\n    return resp.data\n  } else if (resp.status === \"DECLINED\") {\n    throw new Error(`Declined: ${resp.reason || \"No reason supplied.\"}`)\n  } else if (resp.status === \"PENDING\") {\n    var canContinue = true\n    const {close: closeFrame} = frame(resp.local, {\n      onClose() {\n        canContinue = false\n      },\n    })\n\n    return poll(resp.updates, () => canContinue)\n      .then(compositeSignature => {\n        closeFrame()\n        return normalizeCompositeSignature(compositeSignature)\n      })\n      .catch(error => {\n        console.error(error)\n        closeFrame()\n        throw error\n      })\n  } else {\n    console.error(`Auto Decline: Invalid Response`, {service, resp})\n    throw new Error(`Auto Decline: Invalid Response`)\n  }\n}\n","import {execHttpPost} from \"./strategies/http-post\"\nimport {execIframeRPC} from \"./strategies/iframe-rpc\"\n\nconst STRATEGIES = {\n  \"HTTP/RPC\": execHttpPost,\n  \"HTTP/POST\": execHttpPost,\n  \"IFRAME/RPC\": execIframeRPC,\n}\n\nexport async function execService(service, msg) {\n  try {\n    return STRATEGIES[service.method](service, msg)\n  } catch (error) {\n    console.error(\"execService(service, msg)\", error, {service, msg})\n    throw error\n  }\n}\n","import {uid} from \"@onflow/util-uid\"\nimport {frame} from \"./utils/frame\"\nimport {normalizePollingResponse} from \"../../normalize/polling-response\"\nimport {normalizeCompositeSignature} from \"../../normalize/composite-signature\"\n\nexport function execIframeRPC(service, signable) {\n  return new Promise((resolve, reject) => {\n    const id = uid()\n    signable.data = service.data\n\n    frame(service, {\n      onReady(_, {send}) {\n        try {\n          send({\n            jsonrpc: \"2.0\",\n            id: id,\n            method: \"fcl:sign\",\n            params: [signable, service.params],\n          })\n        } catch (error) {\n          throw error\n        }\n      },\n\n      onClose() {\n        reject(`Declined: Externally Halted`)\n      },\n\n      onMessage(e, {close}) {\n        try {\n          if (typeof e.data !== \"object\") return\n          if (e.data.jsonrpc !== \"2.0\") return\n          if (e.data.id !== id) return\n          const resp = normalizePollingResponse(e.data.result)\n\n          switch (resp.status) {\n            case \"APPROVED\":\n              resolve(normalizeCompositeSignature(resp.data))\n              close()\n              break\n\n            case \"DECLINED\":\n              reject(`Declined: ${resp.reason || \"No reason supplied\"}`)\n              close()\n              break\n\n            default:\n              reject(`Declined: No reason supplied`)\n              close()\n              break\n          }\n        } catch (error) {\n          console.error(\"execIframeRPC onMessage error\", error)\n          throw error\n        }\n      },\n    })\n  })\n}\n","import \"../default-config\"\nimport {account} from \"@onflow/sdk-account\"\nimport {config} from \"@onflow/config\"\nimport {spawn, send, INIT, SUBSCRIBE, UNSUBSCRIBE} from \"@onflow/util-actor\"\nimport {sansPrefix} from \"@onflow/util-address\"\nimport {account as fetchAccount} from \"@onflow/sdk-account\"\nimport {renderAuthnFrame} from \"./render-authn-frame\"\nimport {buildUser} from \"./build-user\"\nimport {fetchServices} from \"./fetch-services\"\nimport {mergeServices} from \"./merge-services\"\nimport {serviceOfType} from \"./service-of-type\"\nimport {validateCompositeSignature} from \"./validate-composite-signature\"\nimport {execService} from \"./exec-service\"\n\nconst NAME = \"CURRENT_USER\"\nconst UPDATED = \"CURRENT_USER/UPDATED\"\nconst SNAPSHOT = \"SNAPSHOT\"\nconst SET_CURRENT_USER = \"SET_CURRENT_USER\"\nconst DEL_CURRENT_USER = \"DEL_CURRENT_USER\"\n\n// Backwards Compatibility\nconst CANCEL_EVENT = \"FCL::CANCEL\"\nconst CHALLENGE_RESPONSE_EVENT = \"FCL::CHALLENGE::RESPONSE\"\nconst CHALLENGE_CANCEL_EVENT = \"FCL::CHALLENGE::CANCEL\"\n\nconst DATA = `{\n  \"f_type\": \"User\",\n  \"f_vsn\": \"1.0.0\",\n  \"addr\":null,\n  \"cid\":null,\n  \"loggedIn\":null,\n  \"expiresAt\":null,\n  \"services\":[]\n}`\n\nconst coldStorage = {\n  get: async () => {\n    const fallback = JSON.parse(DATA)\n    const stored = JSON.parse(sessionStorage.getItem(NAME))\n    if (stored != null && fallback[\"f_vsn\"] !== stored[\"f_vsn\"]) {\n      sessionStorage.removeItem(NAME)\n      return fallback\n    }\n    return stored || fallback\n  },\n  put: async data => {\n    sessionStorage.setItem(NAME, JSON.stringify(data))\n    return data\n  },\n}\n\nconst canColdStorage = () => {\n  return config().get(\"persistSession\", true)\n}\n\nconst HANDLERS = {\n  [INIT]: async ctx => {\n    ctx.merge(JSON.parse(DATA))\n    if (await canColdStorage()) {\n      const user = await coldStorage.get()\n      if (notExpired(user)) ctx.merge(user)\n    }\n  },\n  [SUBSCRIBE]: (ctx, letter) => {\n    ctx.subscribe(letter.from)\n    ctx.send(letter.from, UPDATED, {...ctx.all()})\n  },\n  [UNSUBSCRIBE]: (ctx, letter) => {\n    ctx.unsubscribe(letter.from)\n  },\n  [SNAPSHOT]: async (ctx, letter) => {\n    letter.reply({...ctx.all()})\n  },\n  [SET_CURRENT_USER]: async (ctx, letter, data) => {\n    ctx.merge(data)\n    if (await canColdStorage()) coldStorage.put(ctx.all())\n    ctx.broadcast(UPDATED, {...ctx.all()})\n  },\n  [DEL_CURRENT_USER]: async (ctx, letter) => {\n    ctx.merge(JSON.parse(DATA))\n    if (await canColdStorage()) coldStorage.put(ctx.all())\n    ctx.broadcast(UPDATED, {...ctx.all()})\n  },\n}\n\nconst identity = v => v\nconst spawnCurrentUser = () => spawn(HANDLERS, NAME)\n\nfunction notExpired(user) {\n  return (\n    user.expiresAt == null ||\n    user.expiresAt === 0 ||\n    user.expiresAt > Date.now()\n  )\n}\n\nasync function authenticate() {\n  return new Promise(async resolve => {\n    spawnCurrentUser()\n    const user = await snapshot()\n    if (user.loggedIn && notExpired(user)) return resolve(user)\n\n    const [$frame, unrender] = renderAuthnFrame({\n      handshake: await config().get(\"challenge.handshake\"),\n      l6n: window.location.origin,\n    })\n\n    const replyFn = async ({data}) => {\n      if (data.type === CHALLENGE_CANCEL_EVENT || data.type === CANCEL_EVENT) {\n        unrender()\n        window.removeEventListener(\"message\", replyFn)\n        return\n      }\n      if (data.type !== CHALLENGE_RESPONSE_EVENT) return\n\n      unrender()\n      window.removeEventListener(\"message\", replyFn)\n\n      send(NAME, SET_CURRENT_USER, await buildUser(data))\n      resolve(await snapshot())\n    }\n\n    window.addEventListener(\"message\", replyFn)\n  })\n}\n\nfunction unauthenticate() {\n  spawnCurrentUser()\n  send(NAME, DEL_CURRENT_USER)\n}\n\nconst normalizePreAuthzResponse = authz => ({\n  f_type: \"PreAuthzResponse\",\n  f_vsn: \"1.0.0\",\n  proposer: (authz || {}).proposer,\n  payer: (authz || {}).payer || [],\n  authorization: (authz || {}).authorization || [],\n})\n\nfunction resolvePreAuthz(authz) {\n  const resp = normalizePreAuthzResponse(authz)\n  const axs = []\n\n  if (resp.proposer != null) axs.push([\"PROPOSER\", resp.proposer])\n  for (let az of resp.payer || []) axs.push([\"PAYER\", az])\n  for (let az of resp.authorization || []) axs.push([\"AUTHORIZER\", az])\n\n  var result = axs.map(([role, az]) => ({\n    tempId: [az.identity.address, az.identity.keyId].join(\"|\"),\n    addr: az.identity.address,\n    keyId: az.identity.keyId,\n    signingFunction(signable) {\n      return execService(az, signable)\n    },\n    role: {\n      proposer: role === \"PROPOSER\",\n      payer: role === \"PAYER\",\n      authorizer: role === \"AUTHORIZER\",\n    },\n  }))\n  return result\n}\n\nasync function authorization(account) {\n  spawnCurrentUser()\n  const user = await authenticate()\n  const authz = serviceOfType(user.services, \"authz\")\n\n  const preAuthz = serviceOfType(user.services, \"pre-authz\")\n  if (preAuthz) {\n    return {\n      ...account,\n      tempId: \"CURRENT_USER\",\n      async resolve(account, preSignable) {\n        return resolvePreAuthz(await execService(preAuthz, preSignable))\n      },\n    }\n  }\n\n  return {\n    ...account,\n    tempId: \"CURRENT_USER\",\n    resolve: null,\n    addr: sansPrefix(authz.identity.address),\n    keyId: authz.identity.keyId,\n    sequenceNum: null,\n    signature: null,\n    async signingFunction(signable) {\n      return execService(authz, signable)\n    },\n  }\n}\n\nfunction subscribe(callback) {\n  spawnCurrentUser()\n  const EXIT = \"@EXIT\"\n  const self = spawn(async ctx => {\n    ctx.send(NAME, SUBSCRIBE)\n    while (1) {\n      const letter = await ctx.receive()\n      if (letter.tag === EXIT) {\n        ctx.send(NAME, UNSUBSCRIBE)\n        return\n      }\n      callback(letter.data)\n    }\n  })\n  return () => send(self, EXIT)\n}\n\nfunction snapshot() {\n  spawnCurrentUser()\n  return send(NAME, SNAPSHOT, null, {expectReply: true, timeout: 0})\n}\n\nasync function info() {\n  spawnCurrentUser()\n  const {addr} = await snapshot()\n  if (addr == null) throw new Error(\"No Flow Address for Current User\")\n  return account(addr)\n}\n\nexport const currentUser = () => {\n  return {\n    authenticate,\n    unauthenticate,\n    authorization,\n    subscribe,\n    snapshot,\n  }\n}\n","import {renderFrame} from \"./render-frame\"\n\nexport function renderAuthnFrame({handshake, l6n}) {\n  var url = new URL(handshake)\n  url.searchParams.append(\"l6n\", l6n)\n  return renderFrame(url.href)\n}\n","const FRAME_ID = \"FCL_IFRAME\"\n\nexport function renderFrame(src) {\n  if (document.getElementById(FRAME_ID)) return\n\n  const $frame = document.createElement(\"iframe\")\n  $frame.src = src\n  $frame.id = FRAME_ID\n  $frame.allow = \"usb *\"\n  $frame.frameBorder = \"0\"\n  $frame.style.cssText = `\n    position:fixed;\n    top: 0px;\n    right: 0px;\n    bottom: 0px;\n    left: 0px;\n    height: 100vh;\n    width: 100vw;\n    display:block;\n    background:rgba(0,0,0,0.25);\n    z-index: 2147483647;\n    box-sizing: border-box;\n  `\n  document.body.append($frame)\n\n  const unmount = () => {\n    if (document.getElementById(FRAME_ID)) {\n      document.getElementById(FRAME_ID).remove()\n    }\n  }\n\n  return [$frame, unmount]\n}\n","export async function fetchServices(servicesURL, code) {\n  if (servicesURL == null || code == null) return []\n\n  const url = new URL(servicesURL)\n  url.searchParams.append(\"code\", code)\n\n  const resp = await fetch(url, {\n    method: \"GET\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n  }).then(d => d.json())\n\n  if (Array.isArray(resp)) return resp\n\n  // Backwards compatibility for First-Gen Wallet Providers\n  const services = []\n\n  // Convert authorizations into authz services\n  if (Array.isArray(resp.authorizations)) {\n    for (let service of resp.authorizations) {\n      services.push({\n        type: \"authz\",\n        keyId: resp.keyId,\n        ...service,\n      })\n    }\n  }\n\n  // Convert Provider info into an authn service\n  if (resp.provider != null) {\n    services.push({\n      type: \"authn\",\n      id: \"wallet-provider#authn\",\n      ...resp.provider,\n    })\n  }\n\n  return services\n}\n","import {withPrefix} from \"@onflow/util-address\"\n\nexport function mergeServices(sx1 = [], sx2 = []) {\n  // TODO: Make this smarter\n  return [...sx1, ...sx2]\n}\n","import \"./default-config\"\nimport \"./temp\"\nexport {serialize} from \"./serialize\"\nexport {transaction as tx} from \"./transaction\"\nexport {events} from \"./events\"\n\nimport {currentUser} from \"./current-user\"\nexport {currentUser}\n\nexport const authenticate = () => currentUser().authenticate()\nexport const unauthenticate = () => currentUser().unauthenticate()\nexport const reauthenticate = () => {\n  currentUser().unauthenticate()\n  return currentUser().authenticate()\n}\nexport const signUp = () => currentUser().authenticate()\nexport const logIn = () => currentUser().authenticate()\n\nexport const authz = currentUser().authorization\n\nexport {config} from \"@onflow/config\"\nexport {send} from \"@onflow/sdk-send\"\nexport {decode} from \"@onflow/sdk-decode\"\nexport {account} from \"@onflow/sdk-account\"\nexport {latestBlock} from \"@onflow/sdk-latest-block\"\nexport {isOk, isBad, why, pipe} from \"@onflow/interaction\"\nexport {withPrefix, sansPrefix, display} from \"@onflow/util-address\"\nexport {template as cadence} from \"@onflow/util-template\"\nexport {template as cdc} from \"@onflow/util-template\"\n\n// builders\nexport {transaction} from \"@onflow/sdk-build-transaction\"\nexport {script} from \"@onflow/sdk-build-script\"\nexport {ping} from \"@onflow/sdk-build-ping\"\nexport {getAccount} from \"@onflow/sdk-build-get-account\"\nexport {getEvents} from \"@onflow/sdk-build-get-events\"\nexport {getLatestBlock} from \"@onflow/sdk-build-get-latest-block\"\nexport {getBlockById} from \"@onflow/sdk-build-get-block-by-id\"\nexport {getBlockByHeight} from \"@onflow/sdk-build-get-block-by-height\"\nexport {getTransactionStatus} from \"@onflow/sdk-build-transaction-status\"\nexport {authorizations, authorization} from \"@onflow/sdk-build-authorizations\"\nexport {args, arg} from \"@onflow/sdk-build-arguments\"\nexport {proposer} from \"@onflow/sdk-build-proposer\"\nexport {payer} from \"@onflow/sdk-build-payer\"\nexport {limit} from \"@onflow/sdk-build-limit\"\nexport {ref} from \"@onflow/sdk-build-ref\"\nexport {params, param} from \"@onflow/sdk-build-params\"\n\nexport const VERSION = \"0.0.67\"\n","import {interaction, pipe} from \"@onflow/interaction\"\nimport {resolve as defaultResolve} from \"@onflow/sdk-resolve\"\nimport {config} from \"@onflow/config\"\n\nexport const serialize = async (args = [], opts = {}) => {\n  // prettier-ignore\n  const resolveFunction = await config()\n    .get(\"sdk.resolve\", opts.resolve || defaultResolve(opts))\n\n  if (Array.isArray(args)) args = await pipe(interaction(), args)\n  return JSON.stringify(await resolveFunction(args), null, 2)\n}\n"],"names":["put","isFn","v","isString","Symbol","iterator","pact","state","value","s","o","_settle","bind","then","observer","_Pact","prototype","onFulfilled","onRejected","result","this","callback","e","_this","thenable","collectAccounts","ix","accounts","last","depth","authorizations","map","d","tempId","reduce","prev","curr","Array","isArray","invariant","target","body","check","step","reject","_cycle","next","done","_isSettledPact","_fixup","TypeError","values","i","length","push","array","ax","old","role","proposer","payer","authorizer","resolve","acct","f_type","f_vsn","roles","cadence","message","args","arguments","asArgument","data","interaction","error","console","buildPreSignable","t","n","Buffer","from","padStart","u","JSON","stringify","c","toString","a","r","script","refBlock","gasLimit","proposalKey","address","keyId","sequenceNum","authorizers","f","payloadSigs","signerIndex","get","sig","sort","Map","has","set","forEach","k","g","l","m","h","y","name","defaultVal","I","x","K","S","E","Error","fetchSignature","payload","id","signature","signingFunction","addr","sansPrefix","buildSignable","prepForEncoding","computeLimit","cid","current","find","item","pipe","isTransaction","isScript","config","where","Object","entries","replace","arg","xform","recover","latestBlock","_latestBlock","fetchAccount","keys","key","index","sequenceNumber","insideSigners","inside","Set","add","findInsideSigners","insidePayload","Promise","all","outsideSigners","outside","findOutsideSigners","outsidePayload","p","encodeOutsideMessage","fetchTxStatus","transactionId","fclSend","getTransactionStatus","decode","isSealed","tx","status","isExecuted","isFinalized","HANDLERS","INIT","ctx","self","setTimeout","sendSelf","merge","SUBSCRIBE","letter","subscribe","send","UPDATED","UNSUBSCRIBE","unsubscribe","SNAPSHOT","reply","cur","broadcast","scoped","spawnTransaction","spawn","transaction","subscriber","once","predicate","opts","suppress","unsub","txStatus","statusCode","errorMessage","snapshot","snapshoter","onceFinalized","onceExecuted","onceSealed","isUnknown","isPending","isExpired","scheduleTick","hasSubs","hwm","_put4","_put2","getEvents","height","_put3","_put6","clearTimeout","spawnEvents","SERVICE_PRAGMA","IDENTITY_PRAGMA","USER_PRAGMA","POLLING_RESPONSE_PRAGMA","COMPOSITE_SIGNATURE_PRAGMA","normalizeFrame","service","type","endpoint","params","normalizeBackChannelRpc","method","serviceNormalizers","back-channel-rpc","pre-authz","uid","identity","withPrefix","authz","authn","pid","provider","icon","frame","deriveCompositeId","rlp","serviceOfType","services","serviceEndpoint","url","URL","searchParams","append","window","location","origin","fetchService","undefined","fetch","headers","Content-Type","json","normalizePollingResponse","resp","reason","compositeSignature","updates","authorizationUpdates","local","normalizeCompositeSignature","FRAME","noop","IGNORE","log","close","onClose","onMessage","onReady","addEventListener","internal","src","document","getElementById","$frame","createElement","allow","frameBorder","style","cssText","remove","renderFrame","unmount","removeEventListener","msg","contentWindow","postMessage","parse","OPTIONS","HTTP/GET","HTTP/POST","serviceMethod","execHttpPost","signable","canContinue","closeFrame","poll","execService","STRATEGIES","HTTP/RPC","IFRAME/RPC","_","jsonrpc","authorization","account","spawnCurrentUser","authenticate","user","preAuthz","preSignable","resolvePreAuthz","loggedIn","notExpired","l6n","unrender","handshake","href","replyFn","CHALLENGE_CANCEL_EVENT","CANCEL_EVENT","CHALLENGE_RESPONSE_EVENT","paddr","normalizeData","servicesURL","code","fetchServices","hks","sx1","sx2","normalizeService","findService","expiresAt","exp","buildUser","NAME","SET_CURRENT_USER","DATA","coldStorage","sessionStorage","setItem","canColdStorage","fallback","stored","getItem","removeItem","Date","now","unauthenticate","normalizePreAuthzResponse","axs","az","join","test","update","stage","shouldContinue","_resumeAfterTest","_resumeAfterBody","updateValue","receive","tag","_exit2","expectReply","timeout","currentUser","defaultResolve","resolveFunction"],"mappings":"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"}